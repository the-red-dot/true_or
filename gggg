Folder: src
    File: types.d.ts
        Code:
        // src/types.d.ts
        declare module 'use-sound';

    Folder: app
        File: favicon.ico
            [Could not read file: 'utf-8' codec can't decode byte 0x96 in position 50: invalid start byte]
        File: globals.css
            Code:
            @import "tailwindcss";
            
            :root {
              --background: #ffffff;
              --foreground: #171717;
            }
            
            @theme inline {
              --color-background: var(--background);
              --color-foreground: var(--foreground);
              --font-sans: var(--font-geist-sans);
              --font-mono: var(--font-geist-mono);
            }
            
            @media (prefers-color-scheme: dark) {
              :root {
                --background: #0a0a0a;
                --foreground: #ededed;
              }
            }
            
            body {
              background: var(--background);
              color: var(--foreground);
              font-family: Arial, Helvetica, sans-serif;
            }
        File: layout.tsx
            Code:
            import type { Metadata } from "next";
            import { Geist, Geist_Mono } from "next/font/google";
            import "./globals.css";
            
            const geistSans = Geist({
              variable: "--font-geist-sans",
              subsets: ["latin"],
            });
            
            const geistMono = Geist_Mono({
              variable: "--font-geist-mono",
              subsets: ["latin"],
            });
            
            export const metadata: Metadata = {
              title: "Create Next App",
              description: "Generated by create next app",
            };
            
            export default function RootLayout({
              children,
            }: Readonly<{
              children: React.ReactNode;
            }>) {
              return (
                <html lang="en">
                  <body
                    className={`${geistSans.variable} ${geistMono.variable} antialiased`}
                  >
                    {children}
                  </body>
                </html>
              );
            }
        File: page.tsx
            Code:
            // src/app/page.tsx
            "use client";
            
            import React from "react";
            import { motion, AnimatePresence } from "framer-motion";
            import {
              Flame, Trash2, LogOut, User as UserIcon, WifiOff, RefreshCw,
              Cpu, Beer, ThumbsUp, ThumbsDown, LogIn, Play, MessageCircleQuestion, Zap,
              Gavel, Wine // Wine icon for bottle
            } from "lucide-react";
            import QRCode from "react-qr-code";
            import Link from "next/link";
            
            import { useHostGameLogic } from "@/app/hooks/useHostGameLogic";
            import { useGameSounds } from "@/app/hooks/useGameSounds";
            
            export default function TruthOrDareGame() {
              const { playSpin, playShot, playWin } = useGameSounds();
            
              const {
                gameState,
                players,
                heatLevel,
                selectedPlayer,
                lastActivePlayer,
                challengeType,
                currentChallenge,
                joinUrl,
                authUser,
                isConnected,
                reactions,
                votes,
                shotVoteMode,
                currentPenalty,
                previewPenalty, 
                setHeatLevel,
                spinTheWheel,
                handleManualRefresh,
                handleLogout,
                endGame
              } = useHostGameLogic(playSpin, playShot, playWin);
            
              // --- Helper Functions for Penalty UI ---
              const renderPenaltyIcon = (type: string | undefined) => {
                  switch (type) {
                      case 'lemon': 
                        return <div className="text-[150px]">ğŸ‹</div>;
                      case 'vinegar': 
                        return <div className="text-[150px]">ğŸ«—</div>; 
                      case 'onion': 
                        return <div className="text-[150px]">ğŸ§…</div>; 
                      case 'garlic': 
                        return <div className="text-[150px]">ğŸ§„</div>;
                      case 'water':
                        return <div className="text-[150px]">ğŸ’¦</div>;
                      case 'ice':
                        return <div className="text-[150px]">ğŸ§Š</div>;
                      case 'shot': 
                        return <Beer size={180} className="text-yellow-400 drop-shadow-[0_0_30px_rgba(250,204,21,0.8)]" />;
                      case 'kiss_wall':
                        return <div className="text-[150px]">ğŸ’‹</div>;
                      case 'squats':
                        return <div className="text-[150px]">ğŸ‹ï¸</div>;
                      case 'tea_bag':
                        return <div className="text-[150px]">ğŸµ</div>;
                      case 'pasta':
                        return <div className="text-[150px]">ğŸ</div>;
                      case 'lipstick':
                        return <div className="text-[150px]">ğŸ’„</div>;
                      case 'oil':
                        return <div className="text-[150px]">ğŸ¥„</div>;
                      case 'chili':
                        return <div className="text-[150px]">ğŸŒ¶ï¸</div>;
                      default: 
                        return <div className="text-[150px]">ğŸ˜ˆ</div>;
                  }
              };
            
              const getPenaltyColor = (type: string | undefined) => {
                  switch(type) {
                      case 'lemon': return 'bg-yellow-900/95';
                      case 'vinegar': return 'bg-amber-900/95';
                      case 'onion': return 'bg-purple-900/95';
                      case 'garlic': return 'bg-gray-800/95';
                      case 'water': return 'bg-blue-900/95';
                      case 'ice': return 'bg-cyan-900/95';
                      case 'chili': return 'bg-red-950/95';
                      case 'tea_bag': return 'bg-emerald-900/95';
                      default: return 'bg-red-900/90'; 
                  }
              };
            
              return (
                <main
                  className="h-screen w-full bg-black text-white font-sans overflow-hidden relative selection:bg-pink-500 flex flex-col"
                  dir="rtl"
                >
                  <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/40 via-black to-black z-0 pointer-events-none" />
            
                  {/* Top Bar */}
                  {authUser && (
                    <div className="absolute top-6 left-6 z-40 flex items-center gap-4 bg-black/40 backdrop-blur px-4 py-2 rounded-full border border-white/10">
                      <div className="flex flex-col text-left">
                        <span className="text-xs text-gray-400 font-bold uppercase">×§×•×“ ×—×“×¨</span>
                        <span className="text-xl font-mono text-pink-500 tracking-widest">
                          {authUser.email?.split("@")[0] || "..."}
                        </span>
                      </div>
                      <div className="h-8 w-px bg-white/20"></div>
                      <div className="flex items-center gap-2">
                        <UserIcon size={16} /> {players.length}
                      </div>
                      <button onClick={handleManualRefresh} className="p-2 hover:bg-white/20 rounded-full transition-colors text-blue-400" title="×¨×¢× ×•×Ÿ">
                        <RefreshCw size={16} />
                      </button>
                      <button onClick={() => endGame(true)} className="p-2 hover:bg-red-500/20 rounded-full transition-colors text-red-400" title="××™×¤×•×¡ ××©×—×§">
                        <Trash2 size={20} />
                      </button>
                      <button onClick={handleLogout} className="p-2 hover:bg-red-500/20 rounded-full transition-colors text-red-400" title="×”×ª× ×ª×§">
                        <LogOut size={16} />
                      </button>
                      {!isConnected && <WifiOff className="text-red-500 animate-pulse" />}
                    </div>
                  )}
            
                  {/* Global Emojis Overlay (LTR for proper X positioning) */}
                  <div className="fixed inset-0 pointer-events-none z-[100] overflow-hidden" dir="ltr">
                    <AnimatePresence>
                      {reactions.map((r) => (
                        <motion.div
                          key={r.id}
                          initial={{ opacity: 0, scale: 0.5, y: "100vh", x: "-50%" }}
                          animate={{ opacity: 1, scale: [1, 1.5, 1], y: "-20vh" }}
                          exit={{ opacity: 0 }}
                          style={{ left: `${r.x}%` }}
                          transition={{ duration: 4, ease: "easeOut" }}
                          className="absolute text-7xl md:text-8xl drop-shadow-[0_0_15px_rgba(0,0,0,0.8)]"
                        >
                          {r.emoji}
                        </motion.div>
                      ))}
                    </AnimatePresence>
                  </div>
            
                  {/* Main Game Area */}
                  <div className="flex-1 flex flex-col items-center justify-center relative z-10 p-10 h-full">
                    {!authUser && (
                      <motion.div
                        initial={{ scale: 0.9, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="flex flex-col items-center text-center space-y-8 p-10 bg-white/5 rounded-3xl border border-white/10 backdrop-blur-xl"
                      >
                        <div className="bg-pink-600/20 p-6 rounded-full">
                          <Trash2 className="w-20 h-20 text-pink-500 opacity-50" />
                        </div>
                        <h1 className="text-5xl font-black">×”××©×—×§ × ×•×ª×§</h1>
                        <p className="text-xl text-gray-400 max-w-md">
                          ×›×“×™ ×œ×™×™×¦×¨ ×§×•×“ QR ×•×œ×”×ª×—×™×œ ××©×—×§ ×—×“×©, ×¢×œ×™×š ×œ×”×ª×—×‘×¨ ×›×××¨×—.
                        </p>
                        <Link
                          href="/login"
                          className="px-10 py-5 bg-gradient-to-r from-pink-600 to-purple-600 rounded-2xl font-bold text-2xl shadow-xl hover:scale-105 transition-transform flex items-center gap-4"
                        >
                          <LogIn size={32} /> ×”×ª×—×‘×¨ ××—×“×©
                        </Link>
                      </motion.div>
                    )}
            
                    {authUser && (gameState === "lobby" || gameState === "waiting_for_spin") && (
                      <div className="flex flex-col items-center w-full max-w-6xl h-full justify-center">
                        <h1 className="text-8xl md:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-br from-pink-500 via-purple-500 to-cyan-500 drop-shadow-[0_0_30px_rgba(236,72,153,0.5)] mb-12 tracking-tighter">
                          {gameState === "lobby" ? "×××ª ××• ×—×•×‘×”" : "×”×‘× ×‘×ª×•×¨..."}
                        </h1>
            
                        <div className="flex flex-wrap justify-center gap-8 px-4">
                          {players.length === 0 && (
                            <div className="text-2xl text-gray-500 animate-pulse">
                              ×××ª×™×Ÿ ×œ×©×—×§× ×™×... ×¡×¨×§×• ××ª ×”×§×•×“
                            </div>
                          )}
            
                          {players.map((p) => {
                            const isController = lastActivePlayer?.id === p.id;
                            return (
                              <div key={p.id} className="relative group">
                                <div
                                  className={`w-28 h-28 rounded-full border-4 overflow-hidden transition-all duration-300 relative ${
                                    isController
                                      ? "border-yellow-400 shadow-[0_0_40px_rgba(250,204,21,0.6)] scale-110"
                                      : "border-white/20"
                                  }`}
                                >
                                  {p.avatar.startsWith("bg-") ? (
                                    <div className={`w-full h-full ${p.avatar}`} />
                                  ) : (
                                    <img src={p.avatar} className="w-full h-full object-cover" />
                                  )}
                                  {isController && (
                                    <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
                                      <RefreshCw className="text-white w-10 h-10 animate-spin-slow" />
                                    </div>
                                  )}
                                </div>
                                <div className="text-center mt-2 font-bold text-lg drop-shadow-md">
                                  {p.name}
                                </div>
                                {isController && (
                                  <div className="text-center text-yellow-400 text-xs font-bold animate-pulse">
                                    {p.gender === 'female' ? '××—×–×™×§×” ×‘×©×¨×‘×™×˜' : '××—×–×™×§ ×‘×©×¨×‘×™×˜'}
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
            
                        <div className="mt-12 bg-white/5 backdrop-blur-xl p-6 rounded-3xl border border-white/10 flex flex-col md:flex-row items-center gap-8">
                          {players.length >= 2 && (
                            <button
                              onClick={spinTheWheel}
                              className="px-10 py-6 bg-gradient-to-r from-green-600 to-green-500 rounded-2xl font-black text-2xl flex items-center gap-4 hover:scale-105 transition-transform shadow-[0_0_20px_rgba(34,197,94,0.6)]"
                            >
                              <Wine className="rotate-45" size={32} /> 
                              {lastActivePlayer?.gender === 'female' ? "×¡×•×‘×‘×™ ××ª ×”×‘×§×‘×•×§" : "×¡×•×‘×‘ ××ª ×”×‘×§×‘×•×§"}
                            </button>
                          )}
                          
                          {/* Heat Level Selector - Fixed Size Boxes */}
                          <div className="flex gap-4 items-center bg-black/30 p-2 rounded-2xl">
                              {[1, 2, 3].map((level) => (
                                  <button
                                    key={level}
                                    onClick={() => setHeatLevel(level)}
                                    className={`
                                      relative group overflow-hidden w-24 h-24 rounded-xl transition-all duration-300 flex flex-col items-center justify-center border-2
                                      ${heatLevel === level 
                                          ? 'bg-gradient-to-t from-orange-600 to-yellow-500 shadow-[0_0_20px_rgba(251,191,36,0.6)] scale-110 border-yellow-300 z-10' 
                                          : 'bg-gray-800/50 hover:bg-gray-700/50 text-gray-400 border-white/10'}
                                    `}
                                  >
                                      <div className="flex flex-col items-center relative z-10">
                                          <span className={`text-3xl mb-1 ${heatLevel === level ? 'animate-pulse' : 'grayscale opacity-50'}`}>
                                              {level === 1 ? 'ğŸ”¥' : level === 2 ? 'ğŸ”¥ğŸ”¥' : 'ğŸ”¥ğŸ”¥ğŸ”¥'}
                                          </span>
                                          <span className="text-sm font-black uppercase tracking-wide">
                                              {level === 1 ? '×§×œ×™×œ' : level === 2 ? '× ×•×¢×–' : '×œ×•×”×˜'}
                                          </span>
                                      </div>
                                  </button>
                              ))}
                          </div>
            
                          <button
                            onClick={() => endGame(true)}
                            className="p-4 hover:bg-red-900/50 rounded-2xl text-red-400 transition-colors"
                            title="×¡×™×•× ××©×—×§"
                          >
                            <Trash2 size={24} />
                          </button>
                        </div>
                      </div>
                    )}
            
                    {authUser && gameState === "spinning" && (
                      <div className="flex flex-col items-center justify-center relative">
                        <motion.div
                          animate={{ rotate: 360 * 10 }}
                          transition={{ duration: 3, ease: "circOut" }}
                          className="relative z-10"
                        >
                          {/* Spinning Bottle Icon instead of Wheel */}
                          <div className="text-[250px]">ğŸ¾</div>
                        </motion.div>
                        
                        <motion.div 
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            className="mt-12 text-center"
                        >
                            <h2 className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 animate-pulse">
                                ××’×¨×™×œ×™× ×§×•×¨×‘×Ÿ... ğŸ˜ˆ
                            </h2>
                        </motion.div>
                      </div>
                    )}
            
                    {authUser && gameState === "spotlight" && selectedPlayer && (
                      <motion.div
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="text-center flex flex-col items-center"
                      >
                        <div className="w-72 h-72 rounded-full border-8 border-white shadow-[0_0_100px_white] overflow-hidden mb-8 relative">
                          <img src={selectedPlayer.avatar} className="w-full h-full object-cover" />
                        </div>
                        <h2 className="text-8xl font-black text-white mb-4 drop-shadow-lg">
                          {selectedPlayer.name}
                        </h2>
                        <h3 className="text-4xl font-bold text-pink-400 tracking-widest uppercase animate-pulse">
                          {selectedPlayer.gender === "female" ? "×ª×ª×›×•× × ×™!" : "×ª×ª×›×•× ×Ÿ!"}
                        </h3>
                      </motion.div>
                    )}
            
                    {/* Waiting for choice UI */}
                    {authUser && gameState === "waiting_for_choice" && selectedPlayer && (
                        <div className="flex flex-col items-center justify-center space-y-12">
                            <div className="flex gap-12 items-center">
                                <div className="flex flex-col items-center gap-4 opacity-50">
                                    <MessageCircleQuestion size={80} className="text-blue-500" />
                                    <span className="text-2xl font-bold">×××ª?</span>
                                </div>
                                
                                <motion.div 
                                    animate={{ scale: [1, 1.2, 1] }} 
                                    transition={{ repeat: Infinity, duration: 1 }}
                                    className="w-48 h-48 rounded-full border-4 border-white overflow-hidden shadow-[0_0_50px_rgba(255,255,255,0.5)] z-10"
                                >
                                    <img src={selectedPlayer.avatar} className="w-full h-full object-cover" />
                                </motion.div>
            
                                <div className="flex flex-col items-center gap-4 opacity-50">
                                    <Zap size={80} className="text-red-500" />
                                    <span className="text-2xl font-bold">×—×•×‘×”?</span>
                                </div>
                            </div>
                            <h2 className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-red-400 animate-pulse">
                                ×××ª×™×Ÿ ×œ×‘×—×™×¨×”...
                            </h2>
                        </div>
                    )}
            
                    {/* Challenge / Revealing UI */}
                    {authUser &&
                      (gameState === "challenge" || gameState === "revealing") &&
                      currentChallenge &&
                      selectedPlayer && (
                        <div className="flex flex-col items-center justify-between h-full w-full py-10">
                          <motion.div
                            initial={{ y: 50, opacity: 0 }}
                            animate={{ y: 0, opacity: 1 }}
                            className="w-full max-w-5xl px-4 relative z-20"
                          >
                            {/* --- Active Player Avatar Header --- */}
                            <div className="absolute -top-16 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center">
                               <div className="w-32 h-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-black relative z-10">
                                  <img src={selectedPlayer.avatar} className="w-full h-full object-cover" alt="Active Player" />
                               </div>
                               <div className="mt-2 bg-black/80 px-4 py-1 rounded-full text-white font-bold text-lg backdrop-blur-sm shadow-md border border-white/10">
                                  {selectedPlayer.name}
                               </div>
                            </div>
            
                            {/* --- Challenge Card --- */}
                            <div className="bg-gray-900/90 backdrop-blur-xl border border-white/20 p-12 rounded-[3rem] text-center shadow-2xl relative overflow-hidden pt-40">
                              <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-500 to-cyan-500" />
                              
                              {/* Heat Meter Visualization (3 Bars) - TV Version */}
                              <div className="flex flex-col items-center gap-3 mb-8">
                                 <span className="text-gray-400 text-sm font-bold tracking-widest uppercase">
                                    {currentChallenge.spiciness === 1 ? '×§×œ×™×œ' : currentChallenge.spiciness === 2 ? '× ×•×¢×–' : '×œ×•×”×˜ 18+'}
                                 </span>
                                 <div className="flex gap-2">
                                    {Array.from({ length: 3 }).map((_, i) => (
                                       <div
                                         key={i}
                                         className={`w-12 h-4 rounded-full transition-all duration-300 ${
                                           i < currentChallenge.spiciness
                                             ? "bg-gradient-to-r from-orange-600 to-yellow-400 shadow-[0_0_15px_rgba(251,191,36,0.6)]"
                                             : "bg-gray-700/50"
                                         }`}
                                       />
                                    ))}
                                 </div>
                              </div>
            
                              <div className="flex justify-center mb-8">
                                <span
                                  className={`text-5xl font-black px-8 py-3 rounded-full shadow-lg ${
                                    challengeType === "×××ª"
                                      ? "bg-blue-500/20 text-blue-400 border border-blue-500/30"
                                      : "bg-pink-500/20 text-pink-400 border border-pink-500/30"
                                  }`}
                                >
                                  {challengeType}
                                </span>
                              </div>
                              
                              <h3
                                className="text-5xl md:text-7xl font-black leading-tight mb-12 drop-shadow-lg"
                                style={{ direction: "rtl" }}
                              >
                                {currentChallenge.content}
                              </h3>
            
                              <div className="flex items-center gap-4 max-w-lg mx-auto bg-black/50 p-2 rounded-full">
                                <ThumbsUp className="text-green-500" />
                                <div className="flex-1 h-3 bg-gray-700 rounded-full overflow-hidden">
                                  <div
                                    className="bg-green-500 h-full transition-all duration-300"
                                    style={{
                                      width: `${(votes.likes / Math.max(1, players.length - 1)) * 100}%`,
                                    }}
                                  />
                                </div>
                                <div className="flex-1 h-3 bg-gray-700 rounded-full overflow-hidden flex justify-end">
                                  <div
                                    className="bg-red-500 h-full transition-all duration-300"
                                    style={{
                                      width: `${(votes.dislikes / Math.max(1, players.length - 1)) * 100}%`,
                                    }}
                                  />
                                </div>
                                <ThumbsDown className="text-red-500" />
                              </div>
            
                              {currentChallenge.usedModel && (
                                <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-1 text-[10px] text-gray-500 uppercase tracking-widest opacity-30">
                                  <Cpu size={10} /> <span>{currentChallenge.usedModel}</span>
                                </div>
                              )}
                            </div>
                          </motion.div>
                        </div>
                      )}
            
                    {/* Live Penalty Selection Preview */}
                    <AnimatePresence>
                        {gameState === "choosing_penalty" && (
                            <motion.div
                                initial={{ opacity: 0 }}
                                animate={{ opacity: 1 }}
                                exit={{ opacity: 0 }}
                                className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/80 backdrop-blur-md"
                            >
                                <div className="text-center">
                                    <Gavel size={80} className="mx-auto text-purple-500 mb-6 animate-bounce" />
                                    <h2 className="text-6xl font-black text-white mb-4">×‘×•×—×¨×™× ×¢×•× ×©...</h2>
                                    
                                    {lastActivePlayer && (
                                        <div className="flex items-center justify-center gap-3 mb-8">
                                            <img src={lastActivePlayer.avatar} className="w-12 h-12 rounded-full border-2 border-purple-500" />
                                            <span className="text-2xl text-purple-300 font-bold">
                                                {lastActivePlayer.name} {lastActivePlayer.gender === 'female' ? '××—×œ×™×˜×”' : '××—×œ×™×˜'}
                                            </span>
                                        </div>
                                    )}
            
                                    <div className="h-96 flex items-center justify-center">
                                        {previewPenalty ? (
                                            <motion.div 
                                                key={previewPenalty.text}
                                                initial={{ scale: 0.8, opacity: 0 }}
                                                animate={{ scale: 1, opacity: 1 }}
                                                className="bg-gray-800 border border-gray-600 p-8 rounded-3xl max-w-xl text-center"
                                            >
                                                <div className="mb-4 flex justify-center">{renderPenaltyIcon(previewPenalty.type)}</div>
                                                <h3 className="text-4xl font-bold mb-2">{previewPenalty.text}</h3>
                                                {previewPenalty.description && <p className="text-xl text-gray-400 italic">"{previewPenalty.description}"</p>}
                                            </motion.div>
                                        ) : (
                                            <p className="text-xl text-gray-500 animate-pulse">
                                                {lastActivePlayer?.gender === 'female' ? '××ª×œ×‘×˜×ª...' : '××ª×œ×‘×˜...'}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
            
                    {/* Final Penalty Result */}
                    <AnimatePresence>
                      {gameState === "penalty" && (
                        <motion.div
                          initial={{ opacity: 0, scale: 0.8 }}
                          animate={{ opacity: 1, scale: 1 }}
                          exit={{ opacity: 0, scale: 1.2 }}
                          className={`absolute inset-0 z-50 flex flex-col items-center justify-center backdrop-blur-md overflow-hidden ${getPenaltyColor(currentPenalty?.type)}`}
                        >
                          <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] opacity-20" />
                          
                          <motion.div
                            animate={{ rotate: [0, -10, 10, -10, 10, 0] }}
                            transition={{ duration: 0.5, repeat: Infinity, repeatDelay: 1 }}
                            className="mb-8"
                          >
                            {renderPenaltyIcon(currentPenalty?.type)}
                          </motion.div>
            
                          <h1 className="text-9xl font-black uppercase mb-4 text-white drop-shadow-[0_5px_5px_rgba(0,0,0,1)] border-4 border-white p-4">
                            ×”×¢×•× ×© × ×‘×—×¨!
                          </h1>
                          
                          <h2 className="text-6xl font-bold text-white/90 mt-4 text-center px-4 leading-tight drop-shadow-md">
                            {currentPenalty?.text || `${selectedPlayer?.name} ××•×•×ª×¨/×ª!`}
                          </h2>
                          {currentPenalty?.description && (
                              <p className="text-3xl text-white/80 mt-4 italic font-medium">
                                  "{currentPenalty.description}"
                              </p>
                          )}
            
                          <div className="absolute bottom-20 w-full text-center">
                            <p className="text-2xl animate-pulse text-white/70">×”××©×—×§ ×××©×™×š ××™×“...</p>
                          </div>
                        </motion.div>
                      )}
                    </AnimatePresence>
            
                    {/* Group Shot Voting Result */}
                    <AnimatePresence>
                      {shotVoteMode && (
                        <motion.div
                          initial={{ opacity: 0 }}
                          animate={{ opacity: 1 }}
                          exit={{ opacity: 0 }}
                          className="absolute inset-0 z-[100] bg-orange-600 flex flex-col items-center justify-center"
                        >
                          <motion.div animate={{ scale: [1, 1.2, 1] }} transition={{ repeat: Infinity, duration: 0.5 }}>
                            <Beer size={200} className="mb-8 text-yellow-300" />
                          </motion.div>
                          <h1 className="text-8xl font-black text-white border-y-8 border-white py-4">×›×•×œ× ×©×•×ª×™×!</h1>
                          <p className="text-3xl mt-4 font-bold text-orange-200">×”×§×”×œ ×××¨ ××ª ×“×‘×¨×•</p>
                        </motion.div>
                      )}
                    </AnimatePresence>
            
                    {authUser && joinUrl && (
                      <div
                        className={`absolute z-30 transition-all duration-500 bg-white p-2 rounded-xl shadow-2xl ${
                          gameState === "lobby" || gameState === "waiting_for_spin"
                            ? "bottom-20 right-10 scale-125 rotate-3 hover:rotate-0"
                            : "bottom-6 right-6 scale-75 opacity-70 hover:opacity-100"
                        }`}
                      >
                        <QRCode value={joinUrl} size={gameState === "lobby" ? 120 : 100} />
                        {(gameState === "lobby" || gameState === "waiting_for_spin") && (
                          <p className="text-black text-[10px] font-black text-center mt-1 uppercase tracking-widest">
                            ×¡×¨×•×§ ×œ×”×¦×˜×¨×¤×•×ª
                          </p>
                        )}
                      </div>
                    )}
                  </div>
                </main>
              );
            }

        Folder: api

            Folder: generate
                File: route.ts
                    Code:
                    // src/app/api/generate/route.ts
                    
                    import { NextResponse } from "next/server";
                    import { createClient } from "@supabase/supabase-js";
                    
                    // ××ª×—×•×œ ×œ×§×•×— Supabase ×‘×¦×“ ×”×©×¨×ª
                    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
                    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
                    const supabase = createClient(supabaseUrl, supabaseKey);
                    
                    export async function POST(req: Request) {
                      try {
                        const body = await req.json();
                        // ×”×•×¡×¤× ×• ××ª players ×œ×¨×©×™××ª ×”×¤×¨××˜×¨×™× ×”× ×©×œ×¤×™× ××”×‘×§×©×”
                        const { playerName, playerGender, heatLevel, type, previousChallenges, players } = body;
                    
                        // --- Safety Check: Max Heat Cap ---
                        // ××•×¦××™× ××ª ×”×©×—×§×Ÿ ×”×¡×¤×¦×™×¤×™ ×›×“×™ ×œ×‘×“×•×§ ××ª ×”×’×‘×•×œ×•×ª ×©×œ×•
                        let effectiveHeat = heatLevel;
                        
                        // ×× ×• ×× ×™×—×™× ×©-players ××•×¢×‘×¨ ×‘×‘×§×©×” (××”-Client)
                        const activePlayer = players?.find((p: any) => p.name === playerName);
                        
                        if (activePlayer && typeof activePlayer.max_heat_level === 'number') {
                            // ×× ×¨××ª ×”×—×•× ×©× ×‘×—×¨×” ×‘××©×—×§ ×’×‘×•×”×” ××”××§×¡×™××•× ×©×œ ×”×©×—×§×Ÿ, ××©× ××›×™× ××•×ª×”
                            if (effectiveHeat > activePlayer.max_heat_level) {
                                console.log(`Capping heat for ${playerName}: ${effectiveHeat} -> ${activePlayer.max_heat_level}`);
                                effectiveHeat = activePlayer.max_heat_level;
                            }
                        }
                    
                        // × ×¨××•×œ ××’×“×¨ (×”×ª×××” ×œ××‘× ×” ×‘×“××˜×” ×‘×™×™×¡)
                        let dbGender = 'neutral';
                        if (playerGender === 'male') dbGender = 'male';
                        if (playerGender === 'female') dbGender = 'female';
                    
                        // ×œ×•×’×™×§×” ×¤×©×•×˜×” ×œ-3 ×¨××•×ª ×—×•× (1=×§×œ×™×œ, 2=× ×•×¢×–, 3=×œ×•×”×˜)
                        // ×”××©×™××•×ª ×‘-DB ×¦×¨×™×›×•×ª ×œ×”×™×•×ª ××ª×•×™×’×•×ª ×‘-heat_level 1, 2, ××• 3.
                        // ×× ×¨×•×¦×™× ×˜×•×•×— ×’××™×© ×™×•×ª×¨, ××¤×©×¨ ×œ×”×¨×—×™×‘ ×›××Ÿ, ××‘×œ ×œ×¤×™ ×”×“×¨×™×©×” × ×¦××“ ×œ××¡×¤×¨ ×”××“×•×™×§ ××• × ××•×š ××× ×•.
                        
                        // ×©×œ×™×¤×ª ××©×™××•×ª ×¨×œ×•×•× ×˜×™×•×ª ××”-DB
                        // × × ×¡×” ×œ××¦×•× ××©×™××” ×‘×“×™×•×§ ×‘×¨××”, ××• ×¨××” ××—×ª ×¤×—×•×ª ×× ××™×Ÿ (Fallback)
                        const { data: tasks, error } = await supabase
                          .from('game_tasks')
                          .select('*')
                          .eq('type', type) // '×××ª' ××• '×—×•×‘×”'
                          .lte('heat_level', effectiveHeat) // ×××¤×©×¨ ×œ×§×‘×œ ×’× ××©×™××•×ª ×§×œ×•×ª ×™×•×ª×¨ ×× ×”×©×—×§×Ÿ ×‘×—×¨ ×¨××” ×’×‘×•×”×”
                          .gte('heat_level', effectiveHeat === 3 ? 2 : 1) // ×¦××¦×•× ×”×˜×•×•×— ×›×“×™ ×œ× ×œ×§×‘×œ ××©×™××•×ª ×§×œ×•×ª ××“×™ ×‘×¨××•×ª ×’×‘×•×”×•×ª
                          .or(`gender.eq.${dbGender},gender.eq.neutral`);
                    
                        if (error) {
                          console.error("Supabase Error:", error);
                          return NextResponse.json({
                              content: `××©×™××ª ×’×™×‘×•×™ (${type}): ×¡×¤×¨ ×¤×“×™×—×” ×©×§×¨×ª×” ×œ×š ×œ××—×¨×•× ×”!`,
                              spiciness: effectiveHeat,
                              themeColor: "#FF00FF",
                              usedModel: "Backup (DB Error)"
                          });
                        }
                    
                        if (!tasks || tasks.length === 0) {
                            return NextResponse.json({
                                content: `×œ× ××¦××ª×™ ××©×™××” ×œ×¨××” ${effectiveHeat}... ××– ×›×•×œ× ×¢×•×©×™× ×©×•×˜ ×œ×—×™×™×! ğŸ¥‚`,
                                spiciness: effectiveHeat,
                                themeColor: "#FF0000",
                                usedModel: "Database (Empty)"
                            });
                        }
                    
                        // ×¡×™× ×•×Ÿ ××©×™××•×ª ×©×›×‘×¨ ×”×™×• (×œ×¤×™ ×”×˜×§×¡×˜ ×©× ×©×œ×— ××”×§×œ××™×™× ×˜)
                        const availableTasks = tasks.filter((t: any) => 
                            !previousChallenges.some((prev: string) => prev === t.content)
                        );
                    
                        // ×× ×¡×™×™×× ×• ××ª ×›×œ ×”××©×™××•×ª, × ××¤×¡ ×•× ×‘×—×¨ ××›×œ ×”×××’×¨
                        const finalPool = availableTasks.length > 0 ? availableTasks : tasks;
                    
                        // ×ª×¢×“×•×£ ××©×™××•×ª ×©×§×¨×•×‘×•×ª ×™×•×ª×¨ ×œ×¨××” ×©× ×‘×—×¨×”
                        // (×œ××©×œ ×× ×‘×—×¨×ª×™ 3, × ×¢×“×™×£ 3 ×¢×œ ×¤× ×™ 2)
                        finalPool.sort((a: any, b: any) => Math.abs(a.heat_level - effectiveHeat) - Math.abs(b.heat_level - effectiveHeat));
                        
                        // ×œ×•×§×—×™× ××ª ×”×—×¦×™ ×”×¢×œ×™×•×Ÿ ×©×œ ×”×”×ª×××•×ª ×›×“×™ ×œ×©××•×¨ ×¢×œ ×’×™×•×•×Ÿ ××‘×œ ×¨×œ×•×•× ×˜×™×•×ª
                        const topCandidates = finalPool.slice(0, Math.max(3, Math.ceil(finalPool.length / 2)));
                        const randomTask = topCandidates[Math.floor(Math.random() * topCandidates.length)];
                        
                        let content = randomTask.content;
                    
                        // --- ×œ×•×’×™×§×ª ×‘×—×™×¨×ª ×§×•×¨×‘×Ÿ (Victim Logic) ---
                        // ×¨×§ ×× ×”××©×™××” ××›×™×œ×” ××ª ×”×¤×œ×™×™×¡×”×•×œ×“×¨ [chosenName]
                        if (content.includes("[chosenName]") && players && players.length > 0) {
                            let victims: any[] = [];
                            
                            // ×¡×™× ×•×Ÿ ×œ×¤×™ ××’×“×¨ ×”×¤×•×š: ×‘×Ÿ ××§×‘×œ ×‘×ª, ×‘×ª ××§×‘×œ×ª ×‘×Ÿ
                            if (playerGender === 'male') {
                                victims = players.filter((p: any) => p.gender === 'female');
                            } else if (playerGender === 'female') {
                                victims = players.filter((p: any) => p.gender === 'male');
                            }
                    
                            // ×’×™×‘×•×™ 1: ×× ××™×Ÿ ×§×•×¨×‘× ×•×ª ××”××™×Ÿ ×”×©× ×™ (××• ×× ×”××’×“×¨ × ×™×™×˜×¨×œ×™/××—×¨), ×§×— ×›×œ ×©×—×§×Ÿ ×©×”×•× ×œ× ×”××‘×¦×¢ ×¢×¦××•
                            if (victims.length === 0) {
                                victims = players.filter((p: any) => p.name !== playerName);
                            }
                    
                            // ×‘×—×™×¨×ª ×”×§×•×¨×‘×Ÿ ×•×”×—×œ×¤×ª ×”×©× ×‘×˜×§×¡×˜
                            if (victims.length > 0) {
                                const chosenVictim = victims[Math.floor(Math.random() * victims.length)];
                                content = content.replace("[chosenName]", chosenVictim.name);
                            } else {
                                // ×’×™×‘×•×™ 2 (××§×¨×” ×§×™×¦×•×Ÿ): ××©×—×§ ×œ×‘×“ ××• ××™×Ÿ ××£ ××—×“ ××—×¨
                                content = content.replace("[chosenName]", "×¢×¦××š (××™×Ÿ ×¢×•×“ ×©×—×§× ×™×)");
                            }
                        }
                    
                        return NextResponse.json({
                          content: content,
                          spiciness: randomTask.heat_level,
                          themeColor: randomTask.theme_color || '#ec4899',
                          usedModel: "Supabase DB"
                        });
                    
                      } catch (error) {
                        console.error("Critical API Error:", error);
                        return NextResponse.json(
                          { 
                              content: "×ª×§×œ×” ×‘×ª×§×©×•×¨×ª... ×ª×¢×©×” ×©×•×˜!", 
                              spiciness: 1, 
                              themeColor: "#FF0000",
                              usedModel: "Error"
                          },
                          { status: 500 }
                        );
                      }
                    }

        Folder: hooks
            File: useGameSounds.ts
                Code:
                // src/hooks/useGameSounds.ts
                import { useCallback } from 'react';
                
                export const useGameSounds = () => {
                  const playSpin = useCallback(() => {
                    const audio = new Audio('/sounds/spin.mp3'); // ×•×“× ×©×”×§×•×‘×¥ ×§×™×™× ×‘×ª×™×§×™×™×ª public/sounds
                    audio.play().catch(() => console.log('Audio play failed'));
                  }, []);
                
                  const playShot = useCallback(() => {
                    const audio = new Audio('/sounds/shot.mp3'); 
                    audio.play().catch(() => console.log('Audio play failed'));
                  }, []);
                
                  const playWin = useCallback(() => {
                    const audio = new Audio('/sounds/win.mp3'); 
                    audio.play().catch(() => console.log('Audio play failed'));
                  }, []);
                
                  return { playSpin, playShot, playWin };
                };
            File: useHostGameLogic.ts
                Code:
                // src/app/hooks/useHostGameLogic.ts
                import { useState, useEffect, useRef } from "react";
                import { supabase } from "@/app/lib/supabase";
                import { User } from "@supabase/supabase-js";
                import confetti from "canvas-confetti";
                
                // --- Types ---
                export type Player = {
                  id: string;
                  created_at?: string;
                  name: string;
                  gender: "male" | "female" | "other";
                  avatar: string;
                  host_id: string;
                  user_id: string;
                  session_id?: string | null;
                  is_active?: boolean | null;
                  is_adult?: boolean;
                  max_heat_level?: number;
                };
                
                export type Challenge = {
                  content: string;
                  spiciness: number;
                  themeColor: string;
                  usedModel?: string;
                };
                
                export type Reaction = { id: string; emoji: string; playerId: string; x: number };
                
                export type Penalty = {
                    id?: string;
                    type: 'shot' | 'lemon' | 'vinegar' | 'onion' | 'garlic' | 'water' | 'ice' | 'kiss_wall' | 'squats' | 'tea_bag' | 'pasta' | 'lipstick' | 'oil' | 'chili';
                    text: string;
                    description?: string; 
                    is18?: boolean;
                };
                
                export const useHostGameLogic = (
                  playSpinSound: () => void,
                  playShotSound: () => void,
                  playWinSound: () => void
                ) => {
                  // --- State ---
                  const [gameState, setGameState] = useState<
                    "lobby" | "waiting_for_spin" | "spinning" | "spotlight" | "waiting_for_choice" | "revealing" | "challenge" | "choosing_penalty" | "penalty"
                  >("lobby");
                  const [players, setPlayers] = useState<Player[]>([]);
                  const [heatLevel, setHeatLevel] = useState<number>(1);
                  const [selectedPlayer, setSelectedPlayer] = useState<Player | null>(null);
                  const [lastActivePlayer, setLastActivePlayer] = useState<Player | null>(null);
                  const [challengeType, setChallengeType] = useState<"×××ª" | "×—×•×‘×”" | null>(null);
                  const [currentChallenge, setCurrentChallenge] = useState<Challenge | null>(null);
                  const [loadingAI, setLoadingAI] = useState(false);
                  const [joinUrl, setJoinUrl] = useState("");
                
                  const [currentPenalty, setCurrentPenalty] = useState<Penalty | null>(null);
                  const [previewPenalty, setPreviewPenalty] = useState<Penalty | null>(null);
                
                  const [authUser, setAuthUser] = useState<User | null>(null);
                  const [isConnected, setIsConnected] = useState<boolean>(false);
                  const [sessionId, setSessionId] = useState<string | null>(null);
                
                  const [reactions, setReactions] = useState<Reaction[]>([]);
                  const [votes, setVotes] = useState<{ likes: number; dislikes: number; shots: number }>({
                    likes: 0,
                    dislikes: 0,
                    shots: 0,
                  });
                  
                  // ××¢×§×‘ ××—×¨×™ ×©×—×§× ×™× ×©×›×‘×¨ ×”×¦×‘×™×¢×• ×‘×¡×™×‘×•×‘ ×”× ×•×›×—×™ ×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª
                  const [votedPlayers, setVotedPlayers] = useState<Set<string>>(new Set());
                  const [shotVoteMode, setShotVoteMode] = useState(false);
                
                  // --- Helpers ---
                  const genSessionId = () => {
                    try {
                      if (typeof crypto !== "undefined" && crypto.randomUUID) return crypto.randomUUID();
                    } catch {}
                    return `${Date.now()}-${Math.random().toString(16).slice(2)}`;
                  };
                
                  const resetVotes = () => {
                    setVotes({ likes: 0, dislikes: 0, shots: 0 });
                    setVotedPlayers(new Set()); // ××™×¤×•×¡ ×”××¦×‘×™×¢×™×
                    setShotVoteMode(false);
                  };
                
                  const roundEndLockRef = useRef(false);
                
                  const stateRef = useRef({
                    players,
                    lastActivePlayer,
                    gameState,
                    sessionId,
                    selectedPlayer,
                    shotVoteMode,
                    heatLevel,
                    challengeType,
                    currentChallenge,
                    authUser,
                    votes, // ×”×•×¡×¤×ª votes ×œ×¨×£
                    votedPlayers // ×”×•×¡×¤×ª votedPlayers ×œ×¨×£
                  });
                
                  useEffect(() => {
                    stateRef.current = {
                      players,
                      lastActivePlayer,
                      gameState,
                      sessionId,
                      selectedPlayer,
                      shotVoteMode,
                      heatLevel,
                      challengeType,
                      currentChallenge,
                      authUser,
                      votes,
                      votedPlayers
                    };
                  }, [
                    players,
                    lastActivePlayer,
                    gameState,
                    sessionId,
                    selectedPlayer,
                    shotVoteMode,
                    heatLevel,
                    challengeType,
                    currentChallenge,
                    authUser,
                    votes,
                    votedPlayers
                  ]);
                
                  const syncGameStateToDB = async (args: {
                    status: string;
                    currentPlayerId: string | null;
                    controllerId: string | null;
                    heat: number;
                    sid: string | null;
                    challengeText: string | null;
                    challengeT: "×××ª" | "×—×•×‘×”" | null;
                  }) => {
                    const au = stateRef.current.authUser;
                    if (!au) return;
                
                    await supabase.from("game_states").upsert({
                      host_id: au.id,
                      session_id: args.sid,
                      status: args.status,
                      current_player_id: args.currentPlayerId,
                      last_active_player_id: args.controllerId,
                      heat_level: args.heat,
                      challenge_text: args.challengeText,
                      challenge_type: args.challengeT,
                      updated_at: new Date().toISOString(),
                    });
                  };
                
                  const ensureController = (list: Player[]) => {
                    const gs = stateRef.current.gameState;
                    const sid = stateRef.current.sessionId;
                    const au = stateRef.current.authUser;
                    if (!au || !sid) return;
                    if (gs !== "lobby" && gs !== "waiting_for_spin") return;
                    if (list.length === 0) return;
                
                    const current = stateRef.current.lastActivePlayer;
                    const stillExists = current && list.some((p) => p.id === current.id);
                    const controller = stillExists ? current! : list[0];
                
                    if (!stillExists) setLastActivePlayer(controller);
                
                    void syncGameStateToDB({
                      status: gs,
                      currentPlayerId: stateRef.current.selectedPlayer?.id ?? null,
                      controllerId: controller.id,
                      heat: stateRef.current.heatLevel,
                      sid,
                      challengeText: stateRef.current.currentChallenge?.content ?? null,
                      challengeT: stateRef.current.challengeType,
                    });
                  };
                
                  useEffect(() => {
                    const initAuth = async () => {
                      const {
                        data: { user },
                      } = await supabase.auth.getUser();
                      if (user) setAuthUser(user);
                    };
                    initAuth();
                
                    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
                      if (session?.user) {
                        setAuthUser(session.user);
                      } else {
                        setAuthUser(null);
                        setPlayers([]);
                        setSessionId(null);
                        setJoinUrl("");
                        resetVotes();
                      }
                    });
                
                    return () => {
                      authListener.subscription.unsubscribe();
                    };
                  }, []);
                
                  useEffect(() => {
                    if (!authUser) return;
                
                    const loadGame = async () => {
                      const gs = await supabase.from("game_states").select("*").eq("host_id", authUser.id).single();
                
                      let currentSid: string | null = null;
                
                      if (gs.data?.session_id) {
                        const data = gs.data;
                        currentSid = data.session_id;
                        setSessionId(currentSid);
                        if (typeof data.heat_level === "number") setHeatLevel(data.heat_level);
                        if (data.status) setGameState(data.status as any);
                        if (data.challenge_type) setChallengeType(data.challenge_type as any);
                        if (data.challenge_text)
                          setCurrentChallenge({
                            content: data.challenge_text,
                            spiciness: data.heat_level,
                            themeColor: "",
                            usedModel: "Restored",
                          });
                      } else {
                        currentSid = genSessionId();
                        await supabase.from("game_states").upsert({
                          host_id: authUser.id,
                          status: "lobby",
                          heat_level: 1,
                          session_id: currentSid,
                          updated_at: new Date().toISOString(),
                        });
                        setSessionId(currentSid);
                      }
                
                      if (currentSid) {
                        const { data: loadedPlayers } = await supabase
                          .from("players")
                          .select("*")
                          .eq("host_id", authUser.id)
                          .eq("session_id", currentSid)
                          .eq("is_active", true)
                          .order("created_at", { ascending: true });
                
                        if (loadedPlayers) {
                          const list = loadedPlayers as Player[];
                          setPlayers(list);
                
                          if (gs.data) {
                            if (gs.data.current_player_id) {
                              const selected = list.find((p) => p.id === gs.data.current_player_id);
                              if (selected) setSelectedPlayer(selected);
                            }
                            if (gs.data.last_active_player_id) {
                              const active = list.find((p) => p.id === gs.data.last_active_player_id);
                              if (active) setLastActivePlayer(active);
                              else if (list.length > 0) setLastActivePlayer(list[0]);
                            } else if (list.length > 0) {
                              setLastActivePlayer(list[0]);
                            }
                          } else if (list.length > 0) {
                            setLastActivePlayer(list[0]);
                          }
                
                          ensureController(list);
                        }
                      }
                    };
                
                    loadGame();
                    // eslint-disable-next-line react-hooks/exhaustive-deps
                  }, [authUser]);
                
                  const handleManualRefresh = async () => {
                    const au = stateRef.current.authUser;
                    const sid = stateRef.current.sessionId;
                    if (!au || !sid) return;
                
                    const { data } = await supabase
                      .from("players")
                      .select("*")
                      .eq("host_id", au.id)
                      .eq("session_id", sid)
                      .eq("is_active", true)
                      .order("created_at", { ascending: true });
                
                    if (data) {
                      setPlayers(data as Player[]);
                      ensureController(data as Player[]);
                    }
                  };
                
                  const triggerGroupShot = () => {
                    if (roundEndLockRef.current) return;
                    roundEndLockRef.current = true;
                
                    setShotVoteMode(true);
                    playShotSound();
                
                    setTimeout(() => {
                      setShotVoteMode(false);
                      setGameState("waiting_for_spin");
                      setSelectedPlayer(null);
                    }, 5000);
                  };
                
                  const handleDone = () => {
                    if (roundEndLockRef.current) return;
                    roundEndLockRef.current = true;
                
                    confetti({ particleCount: 200, spread: 120 });
                    playWinSound();
                
                    const sp = stateRef.current.selectedPlayer;
                    setLastActivePlayer(sp ?? null);
                
                    setTimeout(() => {
                      setGameState("waiting_for_spin");
                      setSelectedPlayer(null);
                    }, 3000);
                  };
                
                  const handleSkip = () => {
                    if (roundEndLockRef.current) return;
                    setGameState("choosing_penalty");
                    setPreviewPenalty(null); 
                  };
                
                  const executePenalty = (penalty: Penalty) => {
                      if (roundEndLockRef.current) return;
                      roundEndLockRef.current = true;
                
                      setCurrentPenalty(penalty);
                      setGameState("penalty");
                      playShotSound();
                
                      setTimeout(() => {
                        const sp = stateRef.current.selectedPlayer;
                        setLastActivePlayer(sp ?? null);
                        setGameState("waiting_for_spin");
                        setSelectedPlayer(null);
                        setCurrentPenalty(null);
                        setPreviewPenalty(null);
                      }, 6000);
                  };
                
                  const spinTheWheel = () => {
                    const { players: currentPlayers, gameState: gs, lastActivePlayer: controller } = stateRef.current;
                
                    if (currentPlayers.length < 2) {
                      void handleManualRefresh();
                      if (stateRef.current.players.length < 2) return alert("×¦×¨×™×š ×œ×¤×—×•×ª 2 ×©×—×§× ×™× ×›×“×™ ×œ×”×ª×—×™×œ!");
                    }
                
                    if (gs !== "lobby" && gs !== "waiting_for_spin") return;
                
                    roundEndLockRef.current = false;
                    resetVotes();
                
                    setChallengeType(null);
                    setGameState("spinning");
                    playSpinSound();
                
                    setTimeout(() => {
                      const freshPlayers = stateRef.current.players;
                      if (freshPlayers.length === 0) return setGameState("lobby");
                
                      // ×”×©×—×§×Ÿ ×©××—×–×™×§ ×‘×©×¨×‘×™×˜ ×œ× ×™×›×•×œ ×œ×”×™×‘×—×¨
                      let candidates = freshPlayers;
                      if (controller) {
                          candidates = freshPlayers.filter(p => p.id !== controller.id);
                      }
                      
                      if (candidates.length === 0) candidates = freshPlayers;
                
                      const randomPlayer = candidates[Math.floor(Math.random() * candidates.length)];
                      setSelectedPlayer(randomPlayer);
                      setGameState("spotlight");
                    }, 3000);
                  };
                
                  const handleGameEvent = (data: any) => {
                    const { type, payload, playerId } = data;
                    const gs = stateRef.current.gameState;
                    const { votedPlayers } = stateRef.current;
                
                    if (type === "emoji") {
                      const id = Math.random().toString(36);
                      const randomX = Math.random() * 80 + 10;
                      setReactions((prev) => [...prev, { id, emoji: payload, playerId, x: randomX }]);
                      setTimeout(() => setReactions((prev) => prev.filter((r) => r.id !== id)), 4000);
                      return;
                    }
                
                    if (type === "update_heat") {
                      setHeatLevel(payload);
                      return;
                    }
                
                    if (type === "trigger_spin") {
                      spinTheWheel();
                      return;
                    }
                
                    if (type === "player_left") {
                      setPlayers((prev) => {
                        const next = prev.filter((p) => p.id !== playerId);
                        ensureController(next);
                        return next;
                      });
                      return;
                    }
                
                    if (type === "player_choice") {
                        if (gs === "waiting_for_choice" && playerId === stateRef.current.selectedPlayer?.id) {
                            setChallengeType(payload as "×××ª" | "×—×•×‘×”");
                            setGameState("revealing");
                        }
                        return;
                    }
                
                    if (gs === "choosing_penalty") {
                        if (type === "penalty_preview") {
                            setPreviewPenalty(payload); 
                            return;
                        }
                        if (type === "penalty_selected") {
                            executePenalty(payload);
                            return;
                        }
                    }
                
                    if (gs !== "challenge") return;
                
                    if (type === "action_skip") {
                      handleSkip();
                      return;
                    }
                
                    // --- Voting Logic with Double-Vote Prevention ---
                    
                    // ×× ×”×©×—×§×Ÿ ×›×‘×¨ ×”×¦×‘×™×¢ ×‘×¡×™×‘×•×‘ ×”×–×”, ××ª×¢×œ××™×
                    if (votedPlayers.has(playerId)) return;
                
                    // ×”×•×¡×¤×ª ×”×©×—×§×Ÿ ×œ×¨×©×™××ª ×”××¦×‘×™×¢×™×
                    setVotedPlayers(prev => new Set(prev).add(playerId));
                
                    if (type === "vote_like") {
                      setVotes((v) => ({ ...v, likes: v.likes + 1 }));
                      return;
                    }
                
                    if (type === "vote_dislike") {
                      setVotes((v) => ({ ...v, dislikes: v.dislikes + 1 }));
                      return;
                    }
                
                    if (type === "vote_shot") {
                        // ×¨×œ×•×•× ×˜×™ ×¨×§ ×× ×™×© 3 ×©×—×§× ×™× ××• ×™×•×ª×¨
                        if (stateRef.current.players.length < 3) return;
                
                        setVotes((v) => {
                            const newShots = v.shots + 1;
                            // ×¨×•×‘ ××•×—×œ×˜ × ×“×¨×© (×™×•×ª×¨ ×-50% ××”×©×—×§× ×™×, ×œ× ×›×•×œ×œ ×”××‘×¦×¢ ×¢×¦××•? 
                            // ×”×¤×ª×¨×•×Ÿ ×”×¤×©×•×˜: ×™×•×ª×¨ ××—×¦×™ ××›×œ×œ ×”×©×—×§× ×™× ×‘×—×“×¨ ×¤×—×•×ª 1 (×”××‘×¦×¢))
                            // ××‘×œ ×›××Ÿ ×”×‘×§×©×” ×”×™× "2 ×œ×—×¦×•... ××ª×•×š 3". ×–×” ×¨×•×‘ ×¨×’×™×œ ××ª×•×š ×”××¦×‘×™×¢×™× ×”×¤×•×˜× ×¦×™××œ×™×.
                            
                            const potentialVoters = Math.max(1, stateRef.current.players.length - 1); // ×›×•×œ× ×—×•×¥ ××”××‘×¦×¢
                            const threshold = Math.floor(potentialVoters / 2) + 1; // ×¨×•×‘ ××•×—×œ×˜
                
                            if (newShots >= threshold && !stateRef.current.shotVoteMode) {
                                triggerGroupShot();
                            }
                            return { ...v, shots: newShots };
                        });
                        return;
                    }
                  };
                
                  useEffect(() => {
                    if (!authUser || !sessionId) return;
                
                    const hostId = authUser.id;
                
                    const gsChannel = supabase
                      .channel(`gamestate_host_${hostId}`)
                      .on(
                        "postgres_changes",
                        { event: "UPDATE", schema: "public", table: "game_states", filter: `host_id=eq.${hostId}` },
                        (payload) => {
                          const next = payload.new as any;
                          const nextSid: string | null = next?.session_id ?? null;
                
                          if (nextSid && nextSid !== stateRef.current.sessionId) {
                            setSessionId(nextSid);
                            setPlayers([]);
                            setGameState("lobby");
                            resetVotes();
                            return;
                          }
                
                          if (next.status) setGameState(next.status);
                          if (typeof next.heat_level === "number") setHeatLevel(next.heat_level);
                
                          if (next.current_player_id) {
                            const p = stateRef.current.players.find((p) => p.id === next.current_player_id);
                            if (p && p.id !== stateRef.current.selectedPlayer?.id) setSelectedPlayer(p);
                          }
                          if (next.last_active_player_id) {
                            const lp = stateRef.current.players.find((p) => p.id === next.last_active_player_id);
                            if (lp && lp.id !== stateRef.current.lastActivePlayer?.id) setLastActivePlayer(lp);
                          }
                        }
                      )
                      .subscribe();
                
                    const roomChannel = supabase
                      .channel(`room_${hostId}`)
                      .on(
                        "postgres_changes",
                        { event: "INSERT", schema: "public", table: "players", filter: `host_id=eq.${hostId}` },
                        (payload) => {
                          const np = payload.new as any;
                          const sidNow = stateRef.current.sessionId;
                
                          if (np.session_id === sidNow && np.is_active) {
                            setPlayers((prev) => {
                              const next = prev.some((p) => p.id === np.id) ? prev : [...prev, np];
                              ensureController(next);
                              return next;
                            });
                          }
                        }
                      )
                      .on(
                        "postgres_changes",
                        { event: "UPDATE", schema: "public", table: "players", filter: `host_id=eq.${hostId}` },
                        (payload) => {
                          const up = payload.new as any;
                          const sidNow = stateRef.current.sessionId;
                
                          setPlayers((prev) => {
                            let next: Player[];
                            if (up.session_id !== sidNow || !up.is_active) {
                              next = prev.filter((p) => p.id !== up.id);
                            } else {
                              const exists = prev.some((p) => p.id === up.id);
                              next = exists ? prev.map((p) => (p.id === up.id ? up : p)) : [...prev, up];
                            }
                            ensureController(next);
                            return next;
                          });
                        }
                      )
                      .on(
                        "postgres_changes",
                        { event: "DELETE", schema: "public", table: "players", filter: `host_id=eq.${hostId}` },
                        (payload) => {
                          const deletedId = (payload.old as any)?.id;
                          if (!deletedId) return;
                          setPlayers((prev) => {
                            const next = prev.filter((p) => p.id !== deletedId);
                            ensureController(next);
                            return next;
                          });
                        }
                      )
                      .on("broadcast", { event: "game_event" }, (event) => handleGameEvent(event.payload))
                      .subscribe((status) => {
                        setIsConnected(status === "SUBSCRIBED");
                      });
                
                    return () => {
                      supabase.removeChannel(gsChannel);
                      supabase.removeChannel(roomChannel);
                    };
                  }, [authUser, sessionId]);
                
                  useEffect(() => {
                    if (!authUser || !sessionId) return;
                
                    const controllerId =
                      lastActivePlayer?.id ?? (players.length > 0 ? players[0].id : null);
                
                    const t = setTimeout(() => {
                      void syncGameStateToDB({
                        status: gameState,
                        currentPlayerId: selectedPlayer?.id ?? null,
                        controllerId,
                        heat: heatLevel,
                        sid: sessionId,
                        challengeText: currentChallenge?.content ?? null,
                        challengeT: challengeType,
                      });
                    }, 120);
                
                    return () => clearTimeout(t);
                  }, [
                    authUser,
                    sessionId,
                    gameState,
                    selectedPlayer?.id,
                    lastActivePlayer?.id,
                    players.length,
                    heatLevel,
                    challengeType,
                    currentChallenge?.content,
                  ]);
                
                  useEffect(() => {
                    if (gameState !== "challenge") {
                      resetVotes();
                    } else {
                      roundEndLockRef.current = false;
                      resetVotes();
                    }
                  }, [gameState, sessionId]);
                
                  useEffect(() => {
                    if (authUser && typeof window !== "undefined") {
                      setJoinUrl(`${window.location.origin}/join?hostId=${authUser.id}`);
                    }
                  }, [authUser]);
                
                  // --- ×œ×•×’×™×§×ª ×”×›×¨×¢×” ××¢×•×“×›× ×ª ---
                  useEffect(() => {
                    if (gameState !== "challenge") return;
                    if (roundEndLockRef.current) return;
                
                    const voters = Math.max(1, players.length - 1);
                    
                    // ×× ×¦×—: ×ª×™×§×• ××• ×™×•×ª×¨ ×œ×™×™×§×™×
                    // × ×›×©×œ: ×¨×§ ×× ×™×© ×¨×•×‘ ××•×‘×”×§ ×©×œ ×“×™×¡×œ×™×™×§×™× (×™×•×ª×¨ ××—×¦×™ ××”××¦×‘×™×¢×™× ×”×¤×•×˜× ×¦×™××œ×™×)
                    
                    // ×›×“×™ ×œ×× ×•×¢ ×¡×™×•× ××•×§×“× ××“×™ ×›×©×™×© ×¨×§ ×”×¦×‘×¢×” ××—×ª, × ×—×›×” ×œ×¨×•×‘ ××•×—×œ×˜ ×’× ×‘×œ×™×™×§×™×
                    // ××• ×©×¤×©×•×˜ × ×—×›×” ×©×¡×š ×”×”×¦×‘×¢×•×ª ×™×¢×‘×•×¨ ×¡×£ ××¡×•×™×?
                    // × ×œ×š ×œ×¤×™ ×”×”× ×—×™×”: "2 ×“×™×¡×œ×™×™×§ ×•-1 ×œ×™×™×§ -> × ×›×©×œ". "×ª×™×§×• -> ×¢×‘×¨".
                    // ×–×” ××•××¨ ×©×× ×—× ×• ×¦×¨×™×›×™× ×œ×—×›×•×ª ×©×¡×š ×”×”×¦×‘×¢×•×ª ×™×’×™×¢ ×œ××¡×¤×¨ ×”××¦×‘×™×¢×™×? ×œ× ×‘×”×›×¨×—, ×”××©×—×§ ×–×•×¨×.
                    // × ×¢×©×” ×›××• ×§×•×“×: ×× ×”×“×™×¡×œ×™×™×§×™× ×¢×‘×¨×• ××ª ×”×—×¦×™ -> × ×›×©×œ ×‘×˜×•×—.
                    // ×× ×”×œ×™×™×§×™× + ×”×—×¦×™ ×¢×‘×¨×• ××ª ×”×—×¦×™?
                    // ×‘×•× × ×¢×©×” ××ª ×–×” ×¤×©×•×˜: ×× ×¨×•×‘ ×”××¦×‘×™×¢×™× ×”×¤×•×˜× ×¦×™××œ×™× ×”×¦×‘×™×¢×• × ×’×“ -> × ×›×©×œ.
                    // ×× ×¨×•×‘ ×”××¦×‘×™×¢×™× ×”×¤×•×˜× ×¦×™××œ×™× ×”×¦×‘×™×¢×• ×‘×¢×“ (××• ×ª×™×§×• ×‘×˜×•×— ×©×œ× ×™×©×ª× ×”) -> ×¢×‘×¨.
                    
                    if (votes.dislikes > voters / 2) {
                        handleSkip(); // × ×›×©×œ
                    } else if (votes.likes >= voters / 2) {
                        // ×‘×ª×™×§×• ×× ×—× ×• ××¢×‘×™×¨×™×, ××– ×× ×™×© ×—×¦×™ ×œ×™×™×§×™× ×–×” ×›×‘×¨ ×˜×•×‘ (×›×™ ×”××§×¡×™××•× ×“×™×¡×œ×™×™×§ ×™×”×™×” ×—×¦×™ -> ×ª×™×§×• -> ×¢×•×‘×¨)
                        handleDone(); // ×¢×‘×¨
                    }
                    
                  }, [votes, players.length, gameState]);
                
                  useEffect(() => {
                    if (gameState === "spotlight") {
                      const t = setTimeout(() => setGameState("waiting_for_choice"), 3000);
                      return () => clearTimeout(t);
                    }
                  }, [gameState]);
                
                  useEffect(() => {
                    if (gameState === "revealing" && selectedPlayer && challengeType && authUser) {
                      setLoadingAI(true);
                      fetch("/api/generate", {
                        method: "POST",
                        body: JSON.stringify({
                          playerName: selectedPlayer.name,
                          playerGender: selectedPlayer.gender,
                          players: players,
                          heatLevel: heatLevel,
                          type: challengeType,
                          previousChallenges: [],
                        }),
                      })
                        .then((res) => res.json())
                        .then((data) => {
                          setCurrentChallenge(data);
                          setHeatLevel(data.spiciness); 
                          setGameState("challenge");
                        })
                        .catch((err) => {
                          console.error(err);
                          setGameState("challenge");
                        })
                        .finally(() => setLoadingAI(false));
                    }
                  }, [gameState, authUser, selectedPlayer, challengeType, players, heatLevel]);
                
                  const endGame = async (askConfirm = true) => {
                    const au = stateRef.current.authUser;
                    if (!au) return;
                    if (askConfirm && !confirm("×œ×¡×™×™× ××©×—×§ ×•×œ×”×ª×—×™×œ ×—×“×©?")) return;
                
                    await supabase.from("players").delete().eq("host_id", au.id);
                
                    const newSid = genSessionId();
                
                    await supabase.from("game_states").upsert({
                      host_id: au.id,
                      session_id: newSid,
                      status: "lobby",
                      current_player_id: null,
                      last_active_player_id: null,
                      challenge_text: null,
                      challenge_type: null,
                      heat_level: 1,
                      updated_at: new Date().toISOString(),
                    });
                
                    setSessionId(newSid);
                    setPlayers([]);
                    setGameState("lobby");
                    setLastActivePlayer(null);
                    setSelectedPlayer(null);
                    setCurrentChallenge(null);
                    setChallengeType(null);
                    setHeatLevel(1);
                    resetVotes();
                    setCurrentPenalty(null);
                    setPreviewPenalty(null);
                    roundEndLockRef.current = false;
                  };
                
                  const handleLogout = async () => {
                    if (confirm("×œ×”×ª× ×ª×§?")) await supabase.auth.signOut();
                  };
                
                  return {
                    gameState,
                    players,
                    heatLevel,
                    selectedPlayer,
                    lastActivePlayer,
                    challengeType,
                    currentChallenge,
                    joinUrl,
                    authUser,
                    isConnected,
                    reactions,
                    votes,
                    shotVoteMode,
                    currentPenalty,
                    previewPenalty,
                    setHeatLevel,
                    spinTheWheel,
                    handleManualRefresh,
                    handleLogout,
                    endGame,
                  };
                };
            File: usePlayerGameLogic.ts
                Code:
                // src/app/hooks/usePlayerGameLogic.ts
                import { useState, useEffect, useRef } from "react";
                import { supabase } from "@/app/lib/supabase";
                import { RealtimeChannel, User } from "@supabase/supabase-js";
                
                // --- Types ---
                export type GameStateRow = {
                  host_id: string;
                  status: string | null;
                  current_player_id: string | null;
                  last_active_player_id: string | null;
                  heat_level: number | null;
                  challenge_text: string | null;
                  challenge_type: string | null;
                  session_id: string | null;
                };
                
                export type PlayerRow = {
                  id: string;
                  host_id: string;
                  user_id: string;
                  name: string;
                  gender: "male" | "female"; 
                  avatar: string;
                  is_active: boolean | null;
                  session_id: string | null;
                  is_adult: boolean;
                  max_heat_level: number;
                };
                
                // --- UPDATED PENALTIES LIST WITH GENDER SUPPORT ---
                export const PENALTIES_LIST = [
                    { 
                        type: 'shot', 
                        is18: true,
                        gendered: {
                            male: { text: '×©×•×˜ ××œ×›×•×”×•×œ', description: "×™××œ×œ×” ×œ×”×¨×™×! ×¨×§ ×× ××ª×” ×—×•×§×™, ×›×Ÿ?" },
                            female: { text: '×©×•×˜ ××œ×›×•×”×•×œ', description: "×™××œ×œ×” ×œ×”×¨×™×! ×¨×§ ×× ××ª ×—×•×§×™×ª, ×›×Ÿ?" }
                        }
                    },
                    { 
                        type: 'lemon', 
                        gendered: {
                            male: { text: '×©×•×˜ ×©×œ ××™×¥ ×œ×™××•×Ÿ', description: "×¤×¨×¦×•×£ ×—××•×¥ ×–×” ×”×›×™ ×™×¤×” ×œ×š." },
                            female: { text: '×©×•×˜ ×©×œ ××™×¥ ×œ×™××•×Ÿ', description: "×¤×¨×¦×•×£ ×—××•×¥ ×–×” ×”×›×™ ×™×¤×” ×œ×š." }
                        }
                    },
                    { 
                        type: 'kiss_wall', 
                        gendered: {
                            male: { text: '5 × ×©×™×§×•×ª ×œ×§×™×¨', description: "×ª×¤×’×™×Ÿ ××”×‘×” ×œ×§×™×¨, ×”×•× ××§×©×™×‘ ×œ×”×›×œ." },
                            female: { text: '5 × ×©×™×§×•×ª ×œ×§×™×¨', description: "×ª×¤×’×™× ×™ ××”×‘×” ×œ×§×™×¨, ×”×•× ××§×©×™×‘ ×œ×”×›×œ." }
                        }
                    },
                    { 
                        type: 'squats', 
                        gendered: {
                            male: { text: '20 ×¡×§×•×•××˜×™×', description: "×ª×•×¨×™×“ ××ª ×”×˜×•×¡×™×§ × ××•×š, ×©×œ× ×™×™×ª×¤×¡ ×œ×š ×”×’×‘." },
                            female: { text: '20 ×¡×§×•×•××˜×™×', description: "×ª×•×¨×™×“×™ ××ª ×”×˜×•×¡×™×§ × ××•×š, ×©×œ× ×™×™×ª×¤×¡ ×œ×š ×”×’×‘." }
                        }
                    },
                    { 
                        type: 'onion', 
                        gendered: {
                            male: { text: '×ª××›×œ ×˜×‘×¢×ª ×‘×¦×œ', description: "×‘×™×¡ ×‘×¨×™×, ×”×¨×™×— ×‘×—×™× ×." },
                            female: { text: '×ª××›×œ×™ ×˜×‘×¢×ª ×‘×¦×œ', description: "×‘×™×¡ ×‘×¨×™×, ×”×¨×™×— ×‘×—×™× ×." }
                        }
                    },
                    { 
                        type: 'tea_bag', 
                        gendered: {
                            male: { text: '×œ×¢×™×¡×ª ×©×§×™×ª ×ª×”', description: "×ª×”×™×” ×‘×¨×™×˜×™ ×× ×•××¡, ×¨×§ ×‘×œ×™ ×”××™× ×”×—××™×." },
                            female: { text: '×œ×¢×™×¡×ª ×©×§×™×ª ×ª×”', description: "×ª×”×™×™ ×‘×¨×™×˜×™×ª ×× ×•××¡×ª, ×¨×§ ×‘×œ×™ ×”××™× ×”×—××™×." }
                        }
                    },
                    { 
                        type: 'pasta', 
                        gendered: {
                            male: { text: '×œ××›×•×œ ×¤×¡×˜×” ×™×‘×©×”', description: "×§×¨×× ×¥' ××™×˜×œ×§×™, ×‘×ª×™××‘×•×Ÿ ×’×‘×¨." },
                            female: { text: '×œ××›×•×œ ×¤×¡×˜×” ×™×‘×©×”', description: "×§×¨×× ×¥' ××™×˜×œ×§×™, ×‘×ª×™××‘×•×Ÿ." }
                        }
                    },
                    { 
                        type: 'water', 
                        gendered: {
                            male: { text: '××™× ×¢×œ ×”×¤× ×™×', description: "×ª×¨×¢× ×Ÿ ××ª ×¢×¦××š, ××ª×” × ×¨××” ×¢×™×™×£." },
                            female: { text: '××™× ×¢×œ ×”×¤× ×™×', description: "×ª×¨×¢× × ×™ ××ª ×¢×¦××š, ××ª × ×¨××™×ª ×¢×™×™×¤×”." }
                        }
                    },
                    { 
                        type: 'lipstick', 
                        gendered: {
                            male: { text: '×©×¤×ª×•×Ÿ ×œ-10 ×“×§×•×ª', description: "×ª×ª××¤×¨, ×©×™×”×™×” ×œ×š ×‘×•×§ ×§×•×¡××•×¤×•×œ×™×˜×Ÿ." },
                            female: { text: '×©×¤×ª×•×Ÿ ×œ-10 ×“×§×•×ª', description: "×ª×ª××¤×¨×™, ×©×™×”×™×” ×œ×š ×‘×•×§ ×§×•×¡××•×¤×•×œ×™×˜×Ÿ." }
                        }
                    },
                    { 
                        type: 'oil', 
                        gendered: {
                            male: { text: '×›×¤×™×ª ×©××Ÿ', description: "×©×™××•×Ÿ ×”×’×¨×•×Ÿ, ×©×œ× ×ª×—×¨×•×§ ×œ× ×•." },
                            female: { text: '×›×¤×™×ª ×©××Ÿ', description: "×©×™××•×Ÿ ×”×’×¨×•×Ÿ, ×©×œ× ×ª×—×¨×§×™ ×œ× ×•." }
                        }
                    },
                    { 
                        type: 'chili', 
                        gendered: {
                            male: { text: '×‘×™×¡ ×¦\'×™×œ×™ ×—×¨×™×£', description: "×©×•×¨×£ ×œ×™ ×‘×¤×”, ×©×•×¨×£ ×œ×™ ×‘×œ×‘." },
                            female: { text: '×‘×™×¡ ×¦\'×™×œ×™ ×—×¨×™×£', description: "×©×•×¨×£ ×œ×™ ×‘×¤×”, ×©×•×¨×£ ×œ×™ ×‘×œ×‘." }
                        }
                    }
                ];
                
                export const usePlayerGameLogic = (hostId: string | null) => {
                  // Registration State
                  const [name, setName] = useState("");
                  const [gender, setGender] = useState<"male" | "female" | "">("");
                  const [imagePreview, setImagePreview] = useState<string | null>(null);
                  
                  // Safety Settings
                  const [isAdult, setIsAdult] = useState(false);
                  const [personalMaxHeat, setPersonalMaxHeat] = useState(2); 
                
                  const [isSubmitted, setIsSubmitted] = useState(false);
                  const [loading, setLoading] = useState(false);
                
                  // Auth / status
                  const [authUser, setAuthUser] = useState<User | null>(null);
                  const [authReady, setAuthReady] = useState(false);
                
                  // Game Logic State
                  const [myPlayerId, setMyPlayerId] = useState<string | null>(null);
                  const [gameState, setGameState] = useState<GameStateRow | null>(null);
                  const [localHeat, setLocalHeat] = useState(1);
                  
                  // Victim info
                  const [victimIsAdult, setVictimIsAdult] = useState<boolean>(false);
                  const [victimGender, setVictimGender] = useState<"male" | "female">("male");
                
                  // Local Vote Tracking
                  const [hasVoted, setHasVoted] = useState(false);
                  const [allPlayers, setAllPlayers] = useState<PlayerRow[]>([]); // New: Track all players for 18+ calc
                
                  // Refs
                  const myPlayerIdRef = useRef<string | null>(null);
                  const myUserIdRef = useRef<string | null>(null);
                  const sessionIdRef = useRef<string | null>(null);
                  const broadcastRef = useRef<RealtimeChannel | null>(null);
                
                  const pendingActionRef = useRef<{ type: string; payload: any } | null>(null);
                
                  const heatDebounceRef = useRef<number | null>(null);
                  const spinLockRef = useRef(false);
                  const voteLockRef = useRef(false);
                
                  useEffect(() => {
                    myPlayerIdRef.current = myPlayerId;
                  }, [myPlayerId]);
                
                  useEffect(() => {
                    if (!isAdult && personalMaxHeat > 2) {
                      setPersonalMaxHeat(2);
                    }
                  }, [isAdult, personalMaxHeat]);
                
                  // ××™×¤×•×¡ ×”×¦×‘×¢×” ×›×©×¡×˜×˜×•×¡ ×”××©×—×§ ××©×ª× ×”
                  useEffect(() => {
                      if (gameState?.status !== 'challenge') {
                          setHasVoted(false);
                          voteLockRef.current = false;
                      }
                  }, [gameState?.status]);
                
                  // --- Helpers ---
                  const handleKicked = (opts?: { keepInputs?: boolean }) => {
                    if (hostId) localStorage.removeItem(`player_id_${hostId}`);
                
                    pendingActionRef.current = null;
                    spinLockRef.current = false;
                    voteLockRef.current = false;
                    if (heatDebounceRef.current) {
                      window.clearTimeout(heatDebounceRef.current);
                      heatDebounceRef.current = null;
                    }
                
                    setMyPlayerId(null);
                    setIsSubmitted(false);
                  };
                
                  const compressImage = (file: File): Promise<string> => {
                    return new Promise((resolve) => {
                      const reader = new FileReader();
                      reader.readAsDataURL(file);
                      reader.onload = (event) => {
                        const img = new Image();
                        img.src = event.target?.result as string;
                        img.onload = () => {
                          const canvas = document.createElement("canvas");
                          const maxWidth = 300;
                          const scaleSize = maxWidth / img.width;
                          canvas.width = maxWidth;
                          canvas.height = img.height * scaleSize;
                          const ctx = canvas.getContext("2d");
                          ctx?.drawImage(img, 0, 0, canvas.width, canvas.height);
                          resolve(canvas.toDataURL("image/jpeg", 0.7));
                        };
                      };
                    });
                  };
                
                  // --- Effects ---
                
                  // 1. Auth
                  useEffect(() => {
                    if (!hostId) return;
                    (async () => {
                      try {
                        const { data: s0 } = await supabase.auth.getSession();
                        if (!s0.session) await supabase.auth.signInAnonymously();
                        const { data: u } = await supabase.auth.getUser();
                        setAuthUser(u.user ?? null);
                        myUserIdRef.current = u.user?.id ?? null;
                      } catch (e) {
                        console.error("Auth failed:", e);
                      } finally {
                        setAuthReady(true);
                      }
                    })();
                  }, [hostId]);
                
                  // 2. Load Initial Game State
                  useEffect(() => {
                    if (!hostId) return;
                    supabase
                      .from("game_states")
                      .select("*")
                      .eq("host_id", hostId)
                      .single()
                      .then(({ data, error }) => {
                        if (error) {
                          setGameState(null);
                          sessionIdRef.current = null;
                          return;
                        }
                        const gs = data as GameStateRow;
                        setGameState(gs);
                        sessionIdRef.current = gs.session_id ?? null;
                        setLocalHeat(gs.heat_level ?? 1);
                      });
                  }, [hostId]);
                
                  // 3. Realtime Listeners
                  useEffect(() => {
                    if (!hostId) return;
                
                    const bc = supabase.channel(`room_${hostId}`, {
                      config: { broadcast: { self: false } },
                    });
                
                    bc.subscribe((status) => {
                      if (status === "SUBSCRIBED") {
                        broadcastRef.current = bc;
                        const pending = pendingActionRef.current;
                        if (pending) {
                          pendingActionRef.current = null;
                          void sendAction(pending.type, pending.payload);
                        }
                      }
                    });
                
                    const gameStateChannel = supabase
                      .channel(`gamestate_listener_${hostId}`)
                      .on(
                        "postgres_changes",
                        { event: "UPDATE", schema: "public", table: "game_states", filter: `host_id=eq.${hostId}` },
                        async (payload) => {
                          const next = payload.new as GameStateRow;
                          setGameState(next);
                          setLocalHeat(next.heat_level ?? 1);
                
                          if (next.current_player_id) {
                             const { data } = await supabase
                                .from('players')
                                .select('is_adult, gender')
                                .eq('id', next.current_player_id)
                                .single();
                             
                             if (data) {
                                 setVictimIsAdult(data.is_adult);
                                 setVictimGender(data.gender === 'female' ? 'female' : 'male');
                             }
                          }
                
                          const nextSession = next.session_id ?? null;
                          if (nextSession && nextSession !== sessionIdRef.current) {
                            sessionIdRef.current = nextSession;
                            if (myPlayerIdRef.current) handleKicked({ keepInputs: true });
                          }
                
                          if (next.status !== "challenge") {
                            voteLockRef.current = false;
                          }
                        }
                      )
                      .subscribe();
                
                    // -- Updated Players Listener to track ALL players for statistics --
                    const playersChannel = supabase
                      .channel(`players_listener_${hostId}`)
                      .on(
                        "postgres_changes",
                        { event: "*", schema: "public", table: "players", filter: `host_id=eq.${hostId}` },
                        async () => {
                            // ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”×©×—×§× ×™× ×”××œ××” ×‘×›×œ ×©×™× ×•×™
                            // ×–×” ×¤×©×•×˜ ×™×•×ª×¨ ×× ×™×”×•×œ ×“×œ×ª×
                            const { data } = await supabase
                                .from("players")
                                .select("*")
                                .eq("host_id", hostId)
                                .eq("is_active", true); // ×¨×§ ×¤×¢×™×œ×™×
                            
                            if (data) {
                                setAllPlayers(data as PlayerRow[]);
                                
                                // ×‘×“×™×§×” ×× ×”×•×¢×¤×ª×™
                                const myUid = myUserIdRef.current;
                                const me = data.find(p => p.user_id === myUid);
                                
                                if (myPlayerIdRef.current && !me) {
                                    handleKicked({ keepInputs: true });
                                } else if (me && sessionIdRef.current && me.session_id !== sessionIdRef.current) {
                                    handleKicked({ keepInputs: true });
                                }
                            }
                        }
                      )
                      .subscribe();
                      
                      // ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×©×œ ×©×—×§× ×™×
                      supabase.from("players").select("*").eq("host_id", hostId).eq("is_active", true).then(({data}) => {
                          if (data) setAllPlayers(data as PlayerRow[]);
                      });
                
                    return () => {
                      if (heatDebounceRef.current) {
                        window.clearTimeout(heatDebounceRef.current);
                        heatDebounceRef.current = null;
                      }
                      supabase.removeChannel(bc);
                      broadcastRef.current = null;
                      supabase.removeChannel(gameStateChannel);
                      supabase.removeChannel(playersChannel);
                    };
                  }, [hostId]);
                
                  // 4. Restore Session
                  useEffect(() => {
                    if (!hostId || !authReady) return;
                    const myUid = myUserIdRef.current;
                    const sessionId = sessionIdRef.current;
                    if (!myUid || !sessionId) return;
                
                    (async () => {
                      const { data } = await supabase
                        .from("players")
                        .select("id,name,gender,avatar,is_active,session_id,is_adult,max_heat_level")
                        .eq("host_id", hostId)
                        .eq("user_id", myUid)
                        .eq("session_id", sessionId)
                        .maybeSingle();
                
                      if (data && (data as any).is_active !== false) {
                        const p = data as PlayerRow;
                        setMyPlayerId(p.id);
                        setIsSubmitted(true);
                        setName(p.name);
                        setGender(p.gender);
                        setImagePreview(p.avatar);
                        setIsAdult(p.is_adult);
                        setPersonalMaxHeat(p.max_heat_level);
                      }
                    })();
                  }, [hostId, authReady, gameState?.session_id]);
                
                  // --- Actions ---
                  const sendAction = async (type: string, payload: any = {}) => {
                    if (!hostId || !myPlayerIdRef.current) return;
                    const channel = broadcastRef.current;
                    if (!channel) {
                      pendingActionRef.current = { type, payload };
                      return;
                    }
                    try {
                      await channel.send({
                        type: "broadcast",
                        event: "game_event",
                        payload: { type, payload, playerId: myPlayerIdRef.current },
                      });
                    } catch (err) {
                      console.error("Error sending action:", err);
                    }
                  };
                
                  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
                    const file = e.target.files?.[0];
                    if (!file) return;
                    try {
                      const compressed = await compressImage(file);
                      setImagePreview(compressed);
                    } catch {
                      alert("×©×’×™××” ×‘×ª××•× ×”");
                    }
                  };
                
                  const handleJoin = async () => {
                    if (!name || !gender) return alert("×—×¡×¨ ×©× ××• ××™×Ÿ");
                    if (!hostId) return alert("×§×•×“ ××©×—×§ ×©×’×•×™");
                    const sessionId = sessionIdRef.current;
                    if (!sessionId) return alert("×”×—×“×¨ ×œ× ××•×›×Ÿ ×¢×“×™×™×Ÿ. ×”××ª×Ÿ ×©×”×××¨×— ×™×ª×—×‘×¨.");
                
                    setLoading(true);
                    try {
                      const { data: u } = await supabase.auth.getUser();
                      const userId = u.user?.id;
                      if (!userId) throw new Error("No user");
                
                      const { data, error } = await supabase
                        .from("players")
                        .upsert(
                          [{
                              host_id: hostId,
                              user_id: userId,
                              session_id: sessionId,
                              is_active: true,
                              name,
                              gender,
                              avatar: imagePreview ?? "bg-pink-500",
                              is_adult: isAdult,
                              max_heat_level: personalMaxHeat
                            }],
                          { onConflict: "host_id,user_id" }
                        )
                        .select("id")
                        .single();
                
                      if (error) throw error;
                      setMyPlayerId(data.id);
                      setIsSubmitted(true);
                    } catch (e: any) {
                      console.error(e);
                      alert("×©×’×™××” ×‘×”×¦×˜×¨×¤×•×ª");
                    } finally {
                      setLoading(false);
                    }
                  };
                
                  const handleLeaveGame = async () => {
                    if (!confirm("×œ×¦××ª ××”××©×—×§?")) return;
                    const pid = myPlayerIdRef.current;
                    const myUid = myUserIdRef.current;
                    if (!pid || !myUid) return;
                
                    await sendAction("player_left");
                    await supabase.from("players").update({ is_active: false }).eq("id", pid).eq("user_id", myUid);
                    handleKicked({ keepInputs: true });
                  };
                
                  const handleSpin = () => {
                    if (spinLockRef.current) return;
                    spinLockRef.current = true;
                    void sendAction("trigger_spin");
                    window.setTimeout(() => { spinLockRef.current = false; }, 800);
                  };
                
                  const handleHeatChange = (val: number) => {
                    const allowedMax = personalMaxHeat; 
                    let finalVal = val;
                    if (finalVal > allowedMax) finalVal = allowedMax;
                    
                    setLocalHeat(finalVal);
                    if (heatDebounceRef.current) window.clearTimeout(heatDebounceRef.current);
                    heatDebounceRef.current = window.setTimeout(() => {
                      void sendAction("update_heat", finalVal);
                    }, 120);
                  };
                
                  const sendEmoji = (icon: string) => {
                    void sendAction("emoji", icon);
                  };
                
                  const sendVote = (type: "vote_like" | "vote_dislike" | "vote_shot" | "action_skip") => {
                    if (voteLockRef.current || hasVoted) return; // Prevent double vote
                    
                    voteLockRef.current = true;
                    if (type !== 'action_skip') setHasVoted(true); // ×¢×•× ×© ×¢×¦××™ (skip) ×œ× × ×•×¢×œ ××ª ×”×××©×§ ×›××• ×”×¦×‘×¢×” ×¨×’×™×œ×”
                    
                    void sendAction(type);
                    window.setTimeout(() => { voteLockRef.current = false; }, 600);
                  };
                
                  const sendChoice = (choice: "×××ª" | "×—×•×‘×”") => {
                    void sendAction("player_choice", choice);
                  };
                
                  const sendPenaltyPreview = (penalty: any) => {
                      void sendAction("penalty_preview", penalty);
                  };
                
                  const sendPenaltySelection = (penalty: any) => {
                      void sendAction("penalty_selected", penalty);
                  };
                
                  return {
                    name, setName,
                    gender, setGender,
                    imagePreview, handleImageUpload,
                    isAdult, setIsAdult,
                    personalMaxHeat, setPersonalMaxHeat,
                    isSubmitted, loading, authReady, authUser, gameState, localHeat, myPlayerId,
                    victimIsAdult, victimGender,
                    allPlayers, // ×—×©×™×¤×ª ×›×œ×œ ×”×©×—×§× ×™× ×œ×¦×•×¨×š ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                    hasVoted, // ×—×©×™×¤×ª ×”×¡×˜×˜×•×¡ ×× ×”×¦×‘×™×¢
                    handleJoin, handleLeaveGame, handleSpin, handleHeatChange, sendEmoji, sendVote, sendChoice,
                    sendPenaltyPreview, sendPenaltySelection
                  };
                };

        Folder: join
            File: page.tsx
                Code:
                // src/app/join/page.tsx
                "use client";
                
                import React, { Suspense, useState, useMemo } from "react";
                import { motion } from "framer-motion";
                import {
                  Camera, Loader2, AlertTriangle, Beer, XCircle, Flame, LogOut,
                  MessageCircleQuestion, Zap, ShieldCheck, Gavel, Check, ArrowRight, ArrowLeft
                } from "lucide-react";
                import { useSearchParams } from "next/navigation";
                import { usePlayerGameLogic, PENALTIES_LIST } from "@/app/hooks/usePlayerGameLogic";
                
                function GameController() {
                  const searchParams = useSearchParams();
                  const hostId = searchParams.get("hostId");
                
                  const {
                    name, setName,
                    gender, setGender,
                    imagePreview, handleImageUpload,
                    isAdult, setIsAdult,
                    personalMaxHeat, setPersonalMaxHeat,
                    
                    isSubmitted,
                    loading,
                    authReady,
                    authUser,
                    gameState,
                    localHeat,
                    myPlayerId,
                    victimIsAdult,
                    victimGender, 
                    allPlayers, // ×¨×©×™××ª ×›×œ ×”×©×—×§× ×™×
                    hasVoted, // ×”×× ×”××©×ª××© ×›×‘×¨ ×”×¦×‘×™×¢
                    handleJoin,
                    handleLeaveGame,
                    handleSpin,
                    handleHeatChange,
                    sendEmoji,
                    sendVote,
                    sendChoice,
                    sendPenaltyPreview,
                    sendPenaltySelection
                  } = usePlayerGameLogic(hostId);
                
                  // State for carousel
                  const [penaltyIndex, setPenaltyIndex] = useState(0);
                
                  // --- Logic for Group Shot Button ---
                  const showShotButton = useMemo(() => {
                      // ×”×›×¤×ª×•×¨ ×¨×œ×•×•× ×˜×™ ×¨×§ ×× ×™×© 3 ×©×—×§× ×™× ×•××¢×œ×”
                      return allPlayers.length >= 3;
                  }, [allPlayers.length]);
                
                  const enableShotButton = useMemo(() => {
                      if (allPlayers.length === 0) return false;
                      const adultsCount = allPlayers.filter(p => p.is_adult).length;
                      return (adultsCount / allPlayers.length) > 0.5;
                  }, [allPlayers]);
                
                  // --- Helpers for Icons (Copied for consistency on mobile) ---
                  const renderPenaltyIcon = (type: string | undefined) => {
                      switch (type) {
                          case 'lemon': return <div className="text-6xl">ğŸ‹</div>;
                          case 'vinegar': return <div className="text-6xl">ğŸ«—</div>; 
                          case 'onion': return <div className="text-6xl">ğŸ§…</div>; 
                          case 'garlic': return <div className="text-6xl">ğŸ§„</div>;
                          case 'water': return <div className="text-6xl">ğŸ’¦</div>;
                          case 'ice': return <div className="text-6xl">ğŸ§Š</div>;
                          case 'shot': return <Beer size={60} className="text-yellow-400" />;
                          case 'kiss_wall': return <div className="text-6xl">ğŸ’‹</div>;
                          case 'squats': return <div className="text-6xl">ğŸ‹ï¸</div>;
                          case 'tea_bag': return <div className="text-6xl">ğŸµ</div>;
                          case 'pasta': return <div className="text-6xl">ğŸ</div>;
                          case 'lipstick': return <div className="text-6xl">ğŸ’„</div>;
                          case 'oil': return <div className="text-6xl">ğŸ¥„</div>;
                          case 'chili': return <div className="text-6xl">ğŸŒ¶ï¸</div>;
                          default: return <div className="text-6xl">ğŸ˜ˆ</div>;
                      }
                  };
                
                  const t = (male: string, female: string) => {
                      return gender === 'female' ? female : male;
                  }
                
                  const validPenalties = useMemo(() => {
                      return PENALTIES_LIST.filter(p => {
                          if (p.is18 && !victimIsAdult) return false;
                          return true;
                      });
                  }, [victimIsAdult]);
                
                  const currentPenaltyData = useMemo(() => {
                      if (validPenalties.length === 0) return null;
                      const safeIndex = penaltyIndex % validPenalties.length; 
                      const p = validPenalties[safeIndex];
                      const g = victimGender === 'female' ? 'female' : 'male';
                      return {
                          type: p.type,
                          is18: p.is18,
                          ...p.gendered[g]
                      };
                  }, [validPenalties, penaltyIndex, victimGender]);
                
                  
                  // --- Render Functions ---
                
                  if (!hostId) {
                    return (
                      <div className="text-white p-10 text-center flex flex-col items-center justify-center h-screen bg-black" dir="rtl">
                        <AlertTriangle size={48} className="text-red-500 mb-4" />
                        ×§×•×“ ××©×—×§ ×©×’×•×™
                      </div>
                    );
                  }
                
                  const isAnonymous = (authUser as any)?.is_anonymous === true;
                
                  if (isSubmitted && myPlayerId && gameState) {
                    const isMyTurnToPlay = gameState.current_player_id === myPlayerId;
                    const isController = gameState.last_active_player_id === myPlayerId;
                    
                    const isMyTurnToSpin = isController &&
                      (gameState.status === "lobby" || gameState.status === "waiting_for_spin");
                    
                    const isWaitingForChoice = gameState.status === "waiting_for_choice";
                    const isChoosingPenalty = gameState.status === "choosing_penalty" && isController;
                
                    const nextPenalty = () => {
                        const next = (penaltyIndex + 1) % validPenalties.length;
                        setPenaltyIndex(next);
                        const pRaw = validPenalties[next];
                        const g = victimGender === 'female' ? 'female' : 'male';
                        const pResolved = {
                            type: pRaw.type,
                            text: pRaw.gendered[g].text,
                            description: pRaw.gendered[g].description
                        };
                        sendPenaltyPreview(pResolved);
                    }
                
                    const prevPenalty = () => {
                        const prev = (penaltyIndex - 1 + validPenalties.length) % validPenalties.length;
                        setPenaltyIndex(prev);
                        const pRaw = validPenalties[prev];
                        const g = victimGender === 'female' ? 'female' : 'male';
                        const pResolved = {
                            type: pRaw.type,
                            text: pRaw.gendered[g].text,
                            description: pRaw.gendered[g].description
                        };
                        sendPenaltyPreview(pResolved);
                    }
                
                    const confirmPenalty = () => {
                        if (!currentPenaltyData) return;
                        sendPenaltySelection(currentPenaltyData);
                    }
                
                    return (
                      <div className="fixed inset-0 bg-gray-900 text-white flex flex-col overflow-hidden" dir="rtl">
                        {/* Header */}
                        <div className="pt-4 px-4 pb-2 bg-gray-800/50 backdrop-blur-md border-b border-gray-700/50 flex justify-between items-center z-10">
                          <div className="flex items-center gap-3">
                            {imagePreview && <img src={imagePreview} className="w-8 h-8 rounded-full object-cover border border-white" />}
                            <span className="font-bold truncate max-w-[140px]">{name}</span>
                          </div>
                          <div className="flex gap-2 items-center">
                            <div className="text-[10px] px-2 py-1 bg-green-500/20 text-green-400 rounded-full border border-green-500/30 flex items-center">
                              {isAnonymous ? "××—×•×‘×¨" : "××—×•×‘×¨"}
                            </div>
                            <button onClick={handleLeaveGame} className="p-1 bg-red-500/20 text-red-400 rounded-lg" title="×¦× ××”××©×—×§">
                              <LogOut size={16} />
                            </button>
                          </div>
                        </div>
                
                        {/* Main Content */}
                        <div className="flex-1 flex flex-col justify-center items-center p-6 relative w-full max-w-md mx-auto overflow-y-auto">
                          
                          {/* SPIN CONTROLS */}
                          {isMyTurnToSpin && !isWaitingForChoice && (
                            <motion.div initial={{ scale: 0.8, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="w-full space-y-6">
                              <div className="text-center">
                                <h2 className="text-3xl font-black mb-1 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500">
                                  {gameState.status === "lobby" ? t("××ª×” ××ª×—×™×œ!", "××ª ××ª×—×™×œ×”!") : t("×”×©×¨×‘×™×˜ ××¦×œ×š!", "×”×©×¨×‘×™×˜ ××¦×œ×š!")}
                                </h2>
                                <p className="text-gray-400 text-sm">×‘×—×¨ ×¨××ª ×—×•× ×•×¡×•×‘×‘</p>
                              </div>
                
                              <div className="bg-gray-800/80 p-5 rounded-3xl border border-gray-700 shadow-xl">
                                <div className="flex justify-between items-center mb-4">
                                  <span className="flex items-center gap-2 font-bold text-xl text-orange-400">
                                    <Flame className="fill-orange-400" /> {localHeat}
                                  </span>
                                  <span className="text-xs text-gray-400 uppercase tracking-widest">
                                    {localHeat === 1 ? "×§×œ×™×œ" : localHeat === 2 ? "× ×•×¢×–" : "×œ×•×”×˜"}
                                  </span>
                                </div>
                                
                                <div className="flex gap-2 justify-between mb-2">
                                    {[1, 2, 3].map((level) => (
                                        <button
                                            key={level}
                                            onClick={() => handleHeatChange(level)}
                                            disabled={level > personalMaxHeat}
                                            className={`
                                                flex-1 py-3 rounded-xl flex flex-col items-center transition-all duration-200
                                                ${localHeat === level 
                                                    ? 'bg-gradient-to-t from-orange-600 to-yellow-500 text-black shadow-lg scale-105 border-2 border-yellow-300' 
                                                    : 'bg-gray-700 text-gray-400 border border-gray-600'}
                                                ${level > personalMaxHeat ? 'opacity-30 cursor-not-allowed grayscale' : ''}
                                            `}
                                        >
                                            <span className="text-xl mb-1">{level === 1 ? 'ğŸ”¥' : level === 2 ? 'ğŸ”¥ğŸ”¥' : 'ğŸ”¥ğŸ”¥ğŸ”¥'}</span>
                                            <span className="text-[10px] font-bold">{level === 1 ? '×§×œ×™×œ' : level === 2 ? '× ×•×¢×–' : '×œ×•×”×˜'}</span>
                                        </button>
                                    ))}
                                </div>
                
                                <div className="text-[10px] text-gray-500 mt-2 text-center">
                                    ××•×’×‘×œ ×œ××§×¡×™××•× {personalMaxHeat} ×œ×¤×™ ×”×’×“×¨×•×ª ×”×‘×˜×™×—×•×ª ×©×œ×š
                                </div>
                              </div>
                
                              <button
                                onClick={handleSpin}
                                className="w-full py-6 bg-gradient-to-r from-pink-600 to-purple-600 rounded-3xl font-black text-3xl shadow-[0_0_30px_rgba(236,72,153,0.4)] active:scale-95 transition-transform flex items-center justify-center gap-3"
                              >
                                <div className="text-4xl">ğŸ¾</div>
                                {gameState.status === "lobby" ? "××ª×—×™×œ×™×!" : t("×¡×•×‘×‘ ××ª ×”×‘×§×‘×•×§", "×¡×•×‘×‘×™ ××ª ×”×‘×§×‘×•×§")}
                              </button>
                            </motion.div>
                          )}
                
                          {/* PENALTY SELECTION CONTROLS (Only for Controller) */}
                          {isChoosingPenalty && currentPenaltyData && (
                              <motion.div initial={{ y: 50, opacity: 0 }} animate={{ y: 0, opacity: 1 }} className="w-full text-center">
                                  <div className="mb-4">
                                      <Gavel className="mx-auto text-purple-500 mb-2" size={40} />
                                      <h2 className="text-2xl font-black text-white">
                                          {victimGender === 'female' ? "×”×™× ×•×™×ª×¨×”!" : "×”×•× ×•×™×ª×¨!"}
                                      </h2>
                                      <p className="text-gray-300 text-sm">
                                          {gender === 'female' ? "×‘×—×¨×™" : "×‘×—×¨"} {victimGender === 'female' ? "×œ×”" : "×œ×•"} ×¢×•× ×© ××”×¨×©×™××”
                                      </p>
                                  </div>
                
                                  <div className="bg-gray-800 border-2 border-purple-500 rounded-3xl p-6 mb-6 shadow-2xl relative overflow-hidden">
                                      <div className="flex justify-center mb-4">
                                          {renderPenaltyIcon(currentPenaltyData.type)}
                                      </div>
                                      <h3 className="text-xl font-bold mb-2">{currentPenaltyData.text}</h3>
                                      <p className="text-xs text-gray-400 italic mb-4">"{currentPenaltyData.description}"</p>
                                      
                                      {currentPenaltyData.is18 && (
                                          <div className="absolute top-2 right-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded-full">
                                              18+
                                          </div>
                                      )}
                
                                      <div className="flex justify-between items-center mt-4">
                                          <button onClick={prevPenalty} className="p-3 bg-gray-700 rounded-full hover:bg-gray-600 active:scale-90 transition-transform">
                                              <ArrowRight size={24} />
                                          </button>
                                          <span className="text-xs text-gray-500">{penaltyIndex + 1} / {validPenalties.length}</span>
                                          <button onClick={nextPenalty} className="p-3 bg-gray-700 rounded-full hover:bg-gray-600 active:scale-90 transition-transform">
                                              <ArrowLeft size={24} />
                                          </button>
                                      </div>
                                  </div>
                
                                  <button 
                                    onClick={confirmPenalty}
                                    className="w-full py-4 bg-purple-600 rounded-2xl font-bold text-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform"
                                  >
                                      <Check size={24} /> ×‘×—×¨ ×¢×•× ×© ×–×”
                                  </button>
                                  <p className="text-[10px] text-gray-500 mt-2 animate-pulse">×”×‘×—×™×¨×” ××©×•×“×¨×ª ×œ××¡×š ×‘×–××Ÿ ×××ª</p>
                              </motion.div>
                          )}
                
                          {/* CHOICE CONTROLS */}
                          {isWaitingForChoice && isMyTurnToPlay && (
                             <motion.div initial={{ scale: 0.8, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="w-full space-y-4">
                               <div className="text-center mb-6">
                                 <h2 className="text-4xl font-black text-white">{t("×ª×•×¨×š ×œ×‘×—×•×¨!", "×ª×•×¨×š ×œ×‘×—×•×¨!")}</h2>
                                 <p className="text-gray-400">××” ×–×” ×™×”×™×” ×”×¤×¢×?</p>
                               </div>
                               
                               <button 
                                 onClick={() => sendChoice("×××ª")}
                                 className="w-full py-8 bg-blue-600 rounded-3xl flex flex-col items-center justify-center shadow-lg active:scale-95 transition-all border-b-8 border-blue-800"
                               >
                                 <MessageCircleQuestion size={48} className="mb-2 text-blue-200" />
                                 <span className="text-3xl font-black text-white">×××ª</span>
                               </button>
                
                               <button 
                                 onClick={() => sendChoice("×—×•×‘×”")}
                                 className="w-full py-8 bg-red-600 rounded-3xl flex flex-col items-center justify-center shadow-lg active:scale-95 transition-all border-b-8 border-red-800"
                               >
                                 <Zap size={48} className="mb-2 text-yellow-300" />
                                 <span className="text-3xl font-black text-white">×—×•×‘×”</span>
                               </button>
                             </motion.div>
                          )}
                
                          {/* OTHER PLAYER ACTIONS */}
                          {!isMyTurnToSpin && !isWaitingForChoice && !isChoosingPenalty && (
                            <div className="w-full space-y-6">
                              
                              {/* Active Player Controls (Challenge Phase) */}
                              {isMyTurnToPlay && gameState.status === "challenge" && (
                                <motion.div initial={{ y: 20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} className="w-full">
                                  
                                  <div className="bg-gray-800/90 p-6 rounded-3xl border-2 border-pink-500 shadow-2xl mb-4 text-center relative overflow-hidden">
                                      <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-pink-500 to-cyan-500" />
                                      
                                      <div className="mb-4">
                                          <span className={`inline-block px-4 py-1 rounded-full text-sm font-black mb-2 ${
                                              gameState.challenge_type === '×××ª' ? 'bg-blue-500/20 text-blue-400' : 'bg-pink-500/20 text-pink-400'
                                          }`}>
                                              {gameState.challenge_type}
                                          </span>
                                          <h2 className="text-2xl font-black text-white leading-tight" dir="rtl">
                                              {gameState.challenge_text}
                                          </h2>
                                      </div>
                
                                      {/* Heat Meter Compact for Mobile */}
                                      <div className="flex justify-center gap-1 mb-6">
                                          {Array.from({ length: 3 }).map((_, i) => (
                                             <div
                                                key={i}
                                                className={`w-8 h-2 rounded-full ${
                                                  i < (localHeat || 0)
                                                    ? "bg-gradient-to-r from-orange-600 to-yellow-400"
                                                    : "bg-gray-700/50"
                                                }`}
                                             />
                                          ))}
                                      </div>
                
                                      <button
                                        onClick={() => sendVote("action_skip")}
                                        className="w-full py-4 bg-red-500/20 hover:bg-red-500/30 text-red-200 border-2 border-red-500 rounded-2xl font-bold text-lg flex items-center justify-center gap-2 active:scale-95 transition-all"
                                      >
                                        <XCircle size={20} /> {t("×× ×™ ××•×•×ª×¨ (×¢×•× ×©!)", "×× ×™ ××•×•×ª×¨×ª (×¢×•× ×©!)")}
                                      </button>
                                      <p className="text-center text-[10px] text-gray-500 mt-2">×œ×—×™×¦×” ×ª×¢×‘×™×¨ ××ª ×”×”×—×œ×˜×” ×œ××—×–×™×§ ×‘×©×¨×‘×™×˜</p>
                                  </div>
                                </motion.div>
                              )}
                
                              {/* Spectator View */}
                              {!isMyTurnToPlay && gameState.status === "challenge" && (
                                <div className="bg-gray-800/50 p-4 rounded-2xl border border-gray-700 relative">
                                  {/* ×›×™×¡×•×™ ×›×©×›×‘×¨ ×”×¦×‘×¢×ª */}
                                  {hasVoted && (
                                      <div className="absolute inset-0 bg-black/60 backdrop-blur-[2px] z-10 flex items-center justify-center rounded-2xl">
                                          <span className="text-white font-bold bg-black/50 px-4 py-2 rounded-full border border-white/20">×”×¦×‘×¢×ª×š × ×§×œ×˜×”! âœ…</span>
                                      </div>
                                  )}
                
                                  <h3 className="text-center font-bold mb-4 text-gray-300">××” ×“×¢×ª×š ×¢×œ ×”×‘×™×¦×•×¢?</h3>
                                  <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => sendVote("vote_like")} className="bg-green-600/80 p-4 rounded-xl flex justify-center active:scale-95 text-2xl hover:bg-green-500 transition-colors">ğŸ‘</button>
                                    <button onClick={() => sendVote("vote_dislike")} className="bg-red-600/80 p-4 rounded-xl flex justify-center active:scale-95 text-2xl hover:bg-red-500 transition-colors">ğŸ‘</button>
                                  </div>
                                  
                                  {showShotButton && (
                                      <div className="mt-3">
                                          <button 
                                            onClick={() => sendVote("vote_shot")} 
                                            disabled={!enableShotButton}
                                            className={`
                                                w-full p-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-colors
                                                ${enableShotButton 
                                                    ? "bg-orange-600/80 active:scale-95 hover:bg-orange-500 text-white" 
                                                    : "bg-gray-700/50 text-gray-500 cursor-not-allowed grayscale"}
                                            `}
                                          >
                                            <Beer size={18} /> ×›×•×œ× ×©×•×ª×™×!
                                          </button>
                                          {enableShotButton ? (
                                              <p className="text-[10px] text-orange-300/80 text-center mt-1 italic">
                                                  ××™ ×©×—×•×§×™ ××¨×™×, ××™ ×©×œ× - ××“××™×™×Ÿ ğŸ§ƒ
                                              </p>
                                          ) : (
                                              <p className="text-[10px] text-gray-500 text-center mt-1">
                                                  ×–××™×Ÿ ×¨×§ ×›×©×¨×•×‘ ×”×©×—×§× ×™× 18+
                                              </p>
                                          )}
                                      </div>
                                  )}
                                </div>
                              )}
                
                              {/* Status Texts */}
                              {gameState.status !== "challenge" && (
                                <div className="text-center text-gray-400 animate-pulse">
                                  {gameState.status === "spinning" && <div className="text-6xl animate-spin mb-4">ğŸ¾</div>}
                                  {gameState.status === "choosing_penalty" && <div className="text-6xl mb-4 animate-bounce">âš–ï¸</div>}
                                  {gameState.status === "penalty" && <div className="text-6xl mb-4">âš ï¸</div>}
                                  
                                  {gameState.status === "waiting_for_choice" && (
                                     <div className="flex flex-col items-center">
                                         <div className="text-6xl mb-4 animate-bounce">ğŸ¤”</div>
                                         <p className="text-2xl font-bold text-white mb-2">×××ª×™× ×™× ×œ×‘×—×™×¨×”...</p>
                                         {!isMyTurnToPlay && <p className="text-sm">{t("×”×©×—×§×Ÿ ×—×•×©×‘", "×”×©×—×§× ×™×ª ×—×•×©×‘×ª")} ×›×¨×’×¢</p>}
                                     </div>
                                  )}
                                  
                                  <p className="text-xl font-bold">
                                    {gameState.status === "lobby" ? "×××ª×™× ×™× ×œ×××¨×—..." :
                                     gameState.status === "waiting_for_spin" ? "×××ª×™× ×™× ×œ×¡×™×‘×•×‘..." :
                                     gameState.status === "spinning" ? "××’×¨×™×œ..." :
                                     gameState.status === "penalty" ? "×¢×•× ×©!" : 
                                     gameState.status === "choosing_penalty" ? "×”×©×¨×‘×™×˜ ×‘×•×—×¨ ×¢×•× ×©..." :
                                     gameState.status === "revealing" ? "××™×™×¦×¨ ××©×™××”..." :
                                     gameState.status === "waiting_for_choice" ? "" : "×”××©×—×§ ×¨×¥ ×‘×˜×œ×•×•×™×–×™×”..."}
                                  </p>
                                </div>
                              )}
                            </div>
                          )}
                        </div>
                
                        {!isChoosingPenalty && (
                            <div className="w-full pt-3 pb-6 bg-gray-900 border-t border-gray-800 z-10">
                            <p className="text-center text-[10px] text-gray-500 mb-2 font-bold uppercase tracking-widest">×ª×’×•×‘×” ××”×™×¨×”</p>
                            <div className="flex justify-between gap-2 overflow-x-auto pb-2 scrollbar-hide px-2">
                                {[{ icon: "ğŸ˜‚" }, { icon: "ğŸ˜±" }, { icon: "ğŸ˜" }, { icon: "ğŸ¤¢" }, { icon: "ğŸ˜ˆ" }, { icon: "ğŸ«£" }, { icon: "ğŸ”¥" }].map(
                                (item, idx) => (
                                    <button
                                    key={idx}
                                    onClick={() => sendEmoji(item.icon)}
                                    className="bg-gray-800 p-3 rounded-2xl text-2xl active:scale-75 transition-transform shadow-md border border-gray-700 flex-shrink-0 hover:bg-gray-700"
                                    >
                                    {item.icon}
                                    </button>
                                )
                                )}
                            </div>
                            </div>
                        )}
                      </div>
                    );
                  }
                
                  return (
                    <div className="min-h-[100dvh] bg-black text-white p-6 flex flex-col items-center justify-center text-center" dir="rtl">
                        {/* ×§×•×“ ×”×¨×©××” × ×©××¨ ×œ×œ× ×©×™× ×•×™, ×”×©××¨×ª×™ ××ª ×”×§×•××¤×•× × ×˜×” ×”××œ××” ×œ××¢×œ×” */}
                        <div className="w-full max-w-sm space-y-6">
                        <div className="flex justify-center">
                          <div className="text-[10px] px-2 py-1 bg-white/5 text-gray-300 rounded-full border border-white/10">
                            {authReady ? (isAnonymous ? "×¡×˜×˜×•×¡: ××—×•×‘×¨ ×›×× ×•× ×™××™" : "×¡×˜×˜×•×¡: ××—×•×‘×¨") : "×××ª×—×œ ×”×ª×—×‘×¨×•×ª..."}
                          </div>
                        </div>
                
                        <div className="relative mx-auto w-32 h-32">
                          <label className="cursor-pointer block w-full h-full rounded-full border-4 border-dashed border-gray-700 hover:border-pink-500 overflow-hidden transition-colors">
                            {imagePreview ? <img src={imagePreview} className="w-full h-full object-cover" /> : <Camera className="w-full h-full p-8 text-gray-600" />}
                            <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
                          </label>
                        </div>
                
                        <input
                          type="text"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          placeholder="×”×©× ×©×œ×š"
                          className="w-full bg-gray-900 border border-gray-700 rounded-xl p-4 text-center text-xl focus:border-pink-500 outline-none"
                        />
                
                        <div className="flex gap-2 justify-center w-full">
                          {[{ id: "male", l: "×’×‘×¨" }, { id: "female", l: "××™×©×”" }].map((o) => (
                            <button
                              key={o.id}
                              onClick={() => setGender(o.id as any)}
                              className={`flex-1 py-3 rounded-lg border ${gender === o.id ? "bg-pink-600 border-pink-500" : "border-gray-800 bg-gray-900"}`}
                            >
                              {o.l}
                            </button>
                          ))}
                        </div>
                
                        <div className="bg-gray-800/50 p-4 rounded-xl border border-gray-700 w-full text-right">
                            <div className="flex items-center gap-2 mb-4 text-gray-300 border-b border-gray-700 pb-2">
                                <ShieldCheck size={18} className="text-green-400" />
                                <span className="font-bold text-sm">×”×’×“×¨×•×ª ×‘×˜×™×—×•×ª</span>
                            </div>
                
                            <div className="flex items-center justify-between mb-4">
                                <label className="text-sm">×× ×™ {gender === 'female' ? "××¢×œ" : "××¢×œ"} ×’×™×œ 18</label>
                                <input 
                                    type="checkbox" 
                                    checked={isAdult} 
                                    onChange={(e) => setIsAdult(e.target.checked)}
                                    className="w-5 h-5 accent-pink-500"
                                />
                            </div>
                
                            <div className="mb-2">
                                <div className="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>×—×•× ××§×¡×™××œ×™ ×¢×‘×•×¨×™: {personalMaxHeat === 1 ? "×§×œ×™×œ" : personalMaxHeat === 2 ? "× ×•×¢×–" : "×œ×•×”×˜"}</span>
                                    <span>{personalMaxHeat <= 2 ? "×‘×˜×•×—" : "× ×•×¢×–"}</span>
                                </div>
                                
                                <div className="flex gap-2 justify-between mb-2 mt-2">
                                    {[1, 2, 3].map((level) => (
                                        <button
                                            key={level}
                                            onClick={() => setPersonalMaxHeat(level)}
                                            disabled={!isAdult && level > 2}
                                            className={`
                                                flex-1 py-2 rounded-lg flex flex-col items-center transition-all duration-200
                                                ${personalMaxHeat === level 
                                                    ? 'bg-gradient-to-t from-orange-600 to-yellow-500 text-black shadow-lg border border-yellow-300' 
                                                    : 'bg-gray-700 text-gray-400 border border-gray-600'}
                                                ${!isAdult && level > 2 ? 'opacity-30 cursor-not-allowed grayscale' : ''}
                                            `}
                                        >
                                            <span className="text-lg">{level === 1 ? 'ğŸ”¥' : level === 2 ? 'ğŸ”¥ğŸ”¥' : 'ğŸ”¥ğŸ”¥ğŸ”¥'}</span>
                                            <span className="text-[10px] font-bold">{level === 1 ? '×§×œ×™×œ' : level === 2 ? '× ×•×¢×–' : '×œ×•×”×˜'}</span>
                                        </button>
                                    ))}
                                </div>
                
                                <p className="text-[10px] text-gray-500 mt-2 leading-tight">
                                    {isAdult 
                                     ? "×›××©×ª××© ×‘×•×’×¨, ×‘××¤×©×¨×•×ª×š ×œ×‘×—×•×¨ ×›×œ ×¨××ª ×§×•×©×™." 
                                     : "××©×ª××©×™× ××ª×—×ª ×œ×’×™×œ 18 ××•×’×‘×œ×™× ×œ×¨××” 2 ×•××˜×”."}
                                    {" "}×œ×¢×•×œ× ×œ× ×ª×§×‘×œ ××©×™××” ××¢×œ ×”×¨××” ×”×–×•.
                                </p>
                            </div>
                        </div>
                
                        <button
                          onClick={handleJoin}
                          disabled={loading}
                          className="w-full bg-pink-600 py-4 rounded-xl font-black text-xl shadow-lg disabled:opacity-50"
                        >
                          {loading ? <Loader2 className="animate-spin mx-auto" /> : "×™××œ×œ×” ××ª×—×™×œ×™×!"}
                        </button>
                
                        {!gameState?.session_id && (
                          <div className="text-xs text-yellow-300/80 bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-3">
                            ××™×Ÿ session_id ×œ×—×“×¨ ×¢×“×™×™×Ÿ. ×”×××¨×— ×¦×¨×™×š ×œ×”×ª×—×‘×¨ ×§×•×“×.
                          </div>
                        )}
                      </div>
                    </div>
                  );
                }
                
                export default function PlayerJoinPage() {
                  return (
                    <Suspense fallback={<div className="bg-black h-screen text-white flex items-center justify-center">×˜×•×¢×Ÿ...</div>}>
                      <GameController />
                    </Suspense>
                  );
                }

        Folder: lib
            File: supabase.ts
                Code:
                // truth-or-dare-ai\src\app\lib\supabase.ts
                
                import { createClient } from '@supabase/supabase-js';
                
                // ×©×œ×™×¤×ª ×”×”×’×“×¨×•×ª ×××©×ª× ×™ ×”×¡×‘×™×‘×” (×¢× ×¡×™××Ÿ ×§×¨×™××” ×›×“×™ ×œ×”×’×™×“ ×œ-TS ×©×–×” ×§×™×™× ×‘×˜×•×—)
                const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
                const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
                
                export const supabase = createClient(supabaseUrl, supabaseKey);

        Folder: login
            File: page.tsx
                Code:
                // truth-or-dare-ai\src\app\login\page.tsx
                
                "use client";
                
                import React, { useState } from "react";
                import { useRouter } from "next/navigation";
                import { supabase } from "@/app/lib/supabase";
                import { motion } from "framer-motion";
                import { Lock, Mail, ArrowRight, Loader2, PartyPopper } from "lucide-react";
                import Link from "next/link";
                
                export default function LoginPage() {
                  const router = useRouter();
                  const [email, setEmail] = useState("");
                  const [password, setPassword] = useState("");
                  const [loading, setLoading] = useState(false);
                  const [error, setError] = useState<string | null>(null);
                
                  const handleLogin = async (e: React.FormEvent) => {
                    e.preventDefault();
                    setLoading(true);
                    setError(null);
                
                    try {
                      const { error } = await supabase.auth.signInWithPassword({
                        email,
                        password,
                      });
                
                      if (error) throw error;
                
                      // ×”×¦×œ×—×” - ××¢×‘×¨ ×œ×¢××•×“ ×”×¨××©×™
                      router.push("/");
                      router.refresh();
                    } catch (err: any) {
                      setError(err.message === "Invalid login credentials" ? "×¤×¨×˜×™× ×©×’×•×™×™×, × ×¡×” ×©×•×‘" : err.message);
                    } finally {
                      setLoading(false);
                    }
                  };
                
                  return (
                    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center p-6 relative overflow-hidden">
                      {/* Background Ambience */}
                      <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/30 via-black to-black z-0 pointer-events-none" />
                      
                      <motion.div 
                        initial={{ scale: 0.9, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="w-full max-w-md bg-white/5 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl z-10"
                      >
                        <div className="text-center mb-8">
                          <PartyPopper className="w-16 h-16 mx-auto text-pink-500 mb-4" />
                          <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500">
                            ×‘×¨×•×›×™× ×”×©×‘×™×
                          </h1>
                          <p className="text-gray-400 mt-2">×”×›× ×¡ ×œ××¢×¨×›×ª ×›×“×™ ×œ×”×ª×—×™×œ ××ª ×”××¡×™×‘×”</p>
                        </div>
                
                        <form onSubmit={handleLogin} className="space-y-6">
                          <div className="space-y-2">
                            <label className="text-xs font-bold uppercase tracking-widest text-gray-500">××™××™×™×œ</label>
                            <div className="relative">
                              <input
                                type="email"
                                required
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="w-full bg-black/50 border border-gray-700 rounded-xl p-4 pl-12 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-all outline-none"
                                placeholder="you@party.com"
                              />
                              <Mail className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" size={20} />
                            </div>
                          </div>
                
                          <div className="space-y-2">
                            <label className="text-xs font-bold uppercase tracking-widest text-gray-500">×¡×™×¡××”</label>
                            <div className="relative">
                              <input
                                type="password"
                                required
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                className="w-full bg-black/50 border border-gray-700 rounded-xl p-4 pl-12 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-all outline-none"
                                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                              />
                              <Lock className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" size={20} />
                            </div>
                          </div>
                
                          {error && (
                            <div className="bg-red-500/10 border border-red-500/50 text-red-400 p-3 rounded-xl text-sm text-center">
                              {error}
                            </div>
                          )}
                
                          <button
                            type="submit"
                            disabled={loading}
                            className="w-full bg-gradient-to-r from-pink-600 to-purple-600 p-4 rounded-xl font-bold text-lg hover:shadow-[0_0_20px_rgba(236,72,153,0.4)] transition-all flex items-center justify-center gap-2 disabled:opacity-50"
                          >
                            {loading ? <Loader2 className="animate-spin" /> : <>×”×ª×—×‘×¨ <ArrowRight size={20} /></>}
                          </button>
                        </form>
                
                        <div className="mt-8 text-center text-gray-400 text-sm">
                          ×¢×“×™×™×Ÿ ××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ?{" "}
                          <Link href="/register" className="text-pink-400 hover:text-pink-300 font-bold underline decoration-pink-500/30 hover:decoration-pink-500">
                            ×”×™×¨×©× ×›××Ÿ
                          </Link>
                        </div>
                      </motion.div>
                    </div>
                  );
                }

        Folder: register
            File: page.tsx
                Code:
                "use client";
                
                import React, { useState } from "react";
                import { useRouter } from "next/navigation";
                import { supabase } from "@/app/lib/supabase";
                import { motion } from "framer-motion";
                import { Lock, Mail, ArrowRight, Loader2, Sparkles } from "lucide-react";
                import Link from "next/link";
                
                export default function RegisterPage() {
                  const router = useRouter();
                  const [email, setEmail] = useState("");
                  const [password, setPassword] = useState("");
                  const [loading, setLoading] = useState(false);
                  const [error, setError] = useState<string | null>(null);
                
                  const handleRegister = async (e: React.FormEvent) => {
                    e.preventDefault();
                    setLoading(true);
                    setError(null);
                
                    try {
                      const { error } = await supabase.auth.signUp({
                        email,
                        password,
                      });
                
                      if (error) throw error;
                
                      // ×”×¦×œ×—×” - ××¢×‘×¨ ×œ×¢××•×“ ×”×¨××©×™ (××• ×œ×¢××•×“ ×”×’×“×¨×•×ª ×¤×¨×•×¤×™×œ ×× ×ª×¨×¦×” ×‘×¢×ª×™×“)
                      router.push("/");
                      router.refresh();
                    } catch (err: any) {
                      setError(err.message);
                    } finally {
                      setLoading(false);
                    }
                  };
                
                  return (
                    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center p-6 relative overflow-hidden">
                      <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-900/30 via-black to-black z-0 pointer-events-none" />
                      
                      <motion.div 
                        initial={{ scale: 0.9, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="w-full max-w-md bg-white/5 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl z-10"
                      >
                        <div className="text-center mb-8">
                          <Sparkles className="w-16 h-16 mx-auto text-cyan-400 mb-4 animate-pulse" />
                          <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500">
                            ×”×¦×˜×¨×£ ×œ××©×—×§
                          </h1>
                          <p className="text-gray-400 mt-2">×¦×•×¨ ×—×©×‘×•×Ÿ ×•×©××•×¨ ××ª ×”×”×™×¡×˜×•×¨×™×” ×©×œ×š</p>
                        </div>
                
                        <form onSubmit={handleRegister} className="space-y-6">
                          <div className="space-y-2">
                            <label className="text-xs font-bold uppercase tracking-widest text-gray-500">××™××™×™×œ</label>
                            <div className="relative">
                              <input
                                type="email"
                                required
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="w-full bg-black/50 border border-gray-700 rounded-xl p-4 pl-12 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all outline-none"
                                placeholder="you@party.com"
                              />
                              <Mail className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" size={20} />
                            </div>
                          </div>
                
                          <div className="space-y-2">
                            <label className="text-xs font-bold uppercase tracking-widest text-gray-500">×¡×™×¡××”</label>
                            <div className="relative">
                              <input
                                type="password"
                                required
                                minLength={6}
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                className="w-full bg-black/50 border border-gray-700 rounded-xl p-4 pl-12 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all outline-none"
                                placeholder="×œ×¤×—×•×ª 6 ×ª×•×•×™×"
                              />
                              <Lock className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" size={20} />
                            </div>
                          </div>
                
                          {error && (
                            <div className="bg-red-500/10 border border-red-500/50 text-red-400 p-3 rounded-xl text-sm text-center">
                              {error}
                            </div>
                          )}
                
                          <button
                            type="submit"
                            disabled={loading}
                            className="w-full bg-gradient-to-r from-cyan-600 to-purple-600 p-4 rounded-xl font-bold text-lg hover:shadow-[0_0_20px_rgba(8,145,178,0.4)] transition-all flex items-center justify-center gap-2 disabled:opacity-50"
                          >
                            {loading ? <Loader2 className="animate-spin" /> : <>×”×™×¨×©× ×¢×›×©×™×• <ArrowRight size={20} /></>}
                          </button>
                        </form>
                
                        <div className="mt-8 text-center text-gray-400 text-sm">
                          ×›×‘×¨ ×™×© ×œ×š ×—×©×‘×•×Ÿ?{" "}
                          <Link href="/login" className="text-cyan-400 hover:text-cyan-300 font-bold underline decoration-cyan-500/30 hover:decoration-cyan-500">
                            ×”×ª×—×‘×¨ ×›××Ÿ
                          </Link>
                        </div>
                      </motion.div>
                    </div>
                  );
                }

